var PS;
(function(){function d(b){var e;e=typeof b;"number"===e?isNaN(b)&&(e="NaN"):"object"===e&&(b?b instanceof Array&&(e="array"):e="null");return e}function g(b,e,a,c){!0!==b&&!1!==b&&(null===b?b=!1:b===PS.CURRENT?b=e:b===PS.DEFAULT?b=a:(e=d(b),b="undefined"===e?c:"number"===e?0!==b:PS.ERROR));return b}function m(b,e){var a,c,f;for(a in b)b.hasOwnProperty(a)&&(c=b[a],f=d(c),"object"===f&&(f={},m(c,f),c=f),e[a]=c)}function p(b){b.stopPropagation?b.stopPropagation():b.cancelBubble=!0;b.preventDefault();return!1}
function B(){var b,e,a,c;b=[];for(e=0;e<arguments.length;e+=1)a=arguments[e],c=a-65536,a=65535<a?[55296+(c>>10),56320+(c&1023)]:[a],b.push(String.fromCharCode.apply(null,a));return b.join("")}function y(b,e,a,c,f){var l,d,ka,h,E,k,g;l=r.context;d=r.bead_size;ka=b.left;h=b.top;k=E=d;g=b.radius;if(!b.visible||b.size<d||0<g){l.fillStyle=f;l.fillRect(ka,h,E,k);if(!b.visible)return;ka+=b.margin;h+=b.margin;k=E=b.size}f=b.border;0<f.width&&(l.fillStyle=e,g?(e=Math.floor(E*g/100),l.fillRoundedRect(ka,h,
E,k,e)):l.fillRect(ka,h,E,k),ka+=f.left,h+=f.top,E-=f.left+f.right,k-=f.top+f.bottom);l.fillStyle=a;g?(e=Math.floor(E*g/100),l.fillRoundedRect(ka,h,E,k,e)):l.fillRect(ka,h,E,k);0<b.glyph.code&&(r.context.font=b.glyph.font,l.fillStyle=c,l.fillText(b.glyph.str,b.left+b.glyph.x,b.top+b.glyph.y))}function O(b,e,a){var c,f,l,d,h,v,E,k;h=e.r;v=e.g;E=e.b;b=b.planes;e=b.length;for(k=0;k<e;k+=1)if(l=b[k],d=l.color,c=d.r,f=d.g,l=d.b,d=d.a,0<d)if(255>d){d=Math.max(0,Math.min(d/255,1));var g=void 0,g=void 0,
g=1*(1-d);l=g={r:Math.floor(c*d+h*g),g:Math.floor(f*d+v*g),b:Math.floor(l*d+E*g)};h=l.r;v=l.g;E=l.b}else h=c,v=f,E=l;c=h;f=v;l=E;a.rgb=c*M+f*N+l;a.r=c;a.g=f;a.b=l;a.str=ea[c]+Z[f]+xa[l]}function S(b){var e,a,c,f,l,d;e=b.str;a=r.canvas;c=r.context;a.backgroundColor=e;0<r.left&&c.clearRect(0,r.top,r.left,a.height);r.right<a.width&&c.clearRect(r.right,r.top,a.width-r.right,a.height);r.bottom<a.height&&c.clearRect(0,r.bottom,a.width,a.height-r.bottom);document.body.style.backgroundColor=e;ha.div.style.backgroundColor=
e;Va.style.backgroundColor=e;for(a=0;a<r.count;a+=1)c=A[a],f=c.planes[0],f=f.color,255>f.a?(O(c,b,lb),l=lb.str):l=c.color.str,d=c.border.color,(!c.visible||c.size<r.bead_size||0<c.radius||255>f.a||255>d.a)&&y(c,d.str,l,c.glyph.color.str,e)}function w(b){Va.style.color=ea[127<b.r?0:255]+Z[127<b.g?0:255]+xa[127<b.b?0:255]}function $(b){ha.div.style.color=b.str}function ra(b,e){var a;a=A[e];y(a,a.border.color.str,b.str,a.glyph.color.str,r.color.str)}function sa(b,e){var a;a=A[e];y(a,b.str,a.color.str,
a.glyph.color.str,r.color.str)}function Ma(b,e){var a;a=A[e];y(a,a.border.color.str,a.color.str,b.str,r.color.str)}function V(b){Wa=b.dirty=!0}function Q(){var b,e,a;if(Wa){b=r.count;for(e=0;e<b;e+=1)a=A[e],a.dirty&&(a.dirty=!1,y(a,a.border.color.str,a.color.str,a.glyph.color.str,r.color.str));Wa=!1}}function ca(b){if("string"!==typeof b||1>b.length)b="???";PS.debug("WARNING: "+b+"\n")}function F(b,e){var a;db=!1;if("string"!==typeof b||1>b.length)b="???";a="ERROR: "+b+"\n";Va.innerHTML=a;if(Hb&&
e){var c;c=e.stack;var f,l,d;console&&console.log&&console.log(c);if(c.split){c=c.split("\n");d="";f=c.length;for(l=0;l<f;l+=1){var h=c[l],v=void 0,E=void 0,E=void 0,v="";-1!==h.search(".js")?(E=h.lastIndexOf("/")+1,E=h.substr(E).replace(/^[\s\(\)]+|[\s\(\)]+$/g,""),3===E.split(":").length&&(E=E.substr(0,E.lastIndexOf(":"))),""!==E&&(v+="    "+E+"\n")):Ib&&-1!==h.search(".htm")&&(v+="\n"+h);d+=v}c=d}a+=c+"\n"}PS.debug(a);eb&&PS.audioPlay(u.audio.error_sound,{path:u.audio.path});return PS.ERROR}function h(b){try{throw Error("!");
}catch(e){return F(b,e)}}function aa(b){var e;e=u.fader;b.active=!1;b.kill=!1;b.rate=e.rate;b.rgb=e.rgb;b.onEnd=e.onEnd;b.params=e.params;b.r=0;b.g=0;b.b=0;b.step=0;b.frames.length=0}function la(b,e,a){b={element:b,exec:e,execEnd:a,frames:[]};aa(b);return b}function ia(b,e,a,c,f,l,d,h,v){var E,k,g,q,s,n,m,t,r,p,u,P;b.step=0;b.frames.length=0;if(e!==l||a!==d||c!==h||f!==v){E=e;k=a;g=c;q=f;t=e>l?-(e-l):l-e;r=a>d?-(a-d):d-a;p=c>h?-(c-h):h-c;u=f>v?-(f-v):v-f;s=b.rate<fb?1:Math.ceil(b.rate/fb);s=100/s;
n=0;do if(P=!1,m={},n+=s,100<=n?(m.r=l,m.g=d,m.b=h,m.a=v):(E!==l&&(P=n*t/100,E=e+P,E=Math.round(E),P=!0),m.r=E,k!==d&&(P=n*r/100,k=a+P,k=Math.round(k),P=!0),m.g=k,g!==h&&(P=n*p/100,g=c+P,g=Math.round(g),P=!0),m.b=g,q!==v&&(P=n*u/100,q=f+P,q=Math.round(q),P=!0),m.a=q),m.rgb=m.r*M+m.g*N+m.b,m.str=ea[m.r]+Z[m.g]+Z[m.b]+ta[m.a],b.frames.push(m),!P)break;while(100>n)}}function x(b,e,a,c,f,l,d,h,v){ia(b,e,a,c,f,l,d,h,v);0<b.frames.length&&(b.kill=!1,b.active=!0,ya.push(b))}function R(b,e,a,c,f){var l,d,
h;l=b.active;b.active=!1;d=b.frames.length;0<d&&(h=b.step,h>=d&&(h=d-1),d=b.frames[h],ia(b,d.r,d.g,d.b,d.a,e,a,c,f));0<b.frames.length&&(b.active=l)}function s(){var b,e,a,c,f;Ca+=1;if(Ca>=fb)for(Ca=0,b=ya.length,e=0;e<b;)if(a=ya[e],a.kill)ya.splice(e,1),b-=1;else if(a.active){c=a.frames[a.step];if(a.exec)try{a.exec(c,a.element)}catch(l){F("[_tick] fader .exec failed ["+l.message+"]",l);return}a.step+=1;if(a.step>=a.frames.length){a.active=!1;a.step=0;a.frames.length=0;if(a.execEnd)try{a.execEnd(c,
a.element)}catch(d){F("[_tick] fader .execEnd failed ["+d.message+"]",d);return}if(c=a.onEnd){(a=a.params)||(a=[]);try{c.apply(ba,a)}catch(h){F("[_tick] fader .onEnd failed ["+h.message+"]",h);return}}ya.splice(e,1);b-=1}else e+=1}else e+=1;b=X.length;if(Na&&0<b)if(0<Da)Da-=1;else for(Da=Oa,e=0;e<b;e+=1)if(a=X[e])try{PS.keyDown(a,na,ua)}catch(v){F("[_tick] Key repeat failed ["+v.message+"]",v);return}b=oa.length;if(0<b){for(e=0;e<b;){a=oa[e];c=a.id;a.count-=1;if(1>a.count){a.count=a.delay;try{f=a.exec.apply(ba,
a.arglist)}catch(k){f=F("[_tick] Timed function failed ["+k.message+"]",k)}f===PS.ERROR&&PS.timerStop(c);b=oa.length}(a=oa[e])&&a.id===c&&(e+=1)}Q()}}function k(b){var e,a,c,f,l,d,h,v;O(b,r.color,Ea);e=Ea.rgb;a=b.color;c=Ea.r;f=Ea.g;l=Ea.b;d=a.r;h=a.g;v=a.b;a.rgb=e;a.r=c;a.g=f;a.b=l;a.str=Ea.str;b.visible&&(e=b.fader,0<e.rate?null!==e.rgb?x(e,e.r,e.g,e.b,255,c,f,l,255):e.active?R(e,c,f,l,255):x(e,d,h,v,255,c,f,l,255):V(b))}function q(b,e,a,c,f){var l;if(a!==PS.CURRENT&&a!==PS.DEFAULT)if(l=d(a),"undefined"===
l)a=PS.CURRENT;else if("number"===l)a=Math.floor(a),0>a?a=0:255<a&&(a=255);else return h(b+"red value invalid");if(c!==PS.CURRENT&&c!==PS.DEFAULT)if(l=d(c),"undefined"===l)c=PS.CURRENT;else if("number"===l)c=Math.floor(c),0>c?c=0:255<c&&(c=255);else return h(b+"green value invalid");if(f!==PS.CURRENT&&f!==PS.DEFAULT)if(l=d(f),"undefined"===l)f=PS.CURRENT;else if("number"===l)f=Math.floor(f),0>f?f=0:255<f&&(f=255);else return h(b+"blue value invalid");e.rgb=null;e.r=a;e.g=c;e.b=f;return PS.DONE}function t(b,
e){var a,c,f,l,d;a=Math.floor(e);1>a?a=c=l=f=0:16777215<=a?(a=16777215,c=l=f=255):(c=a/M,c=Math.floor(c),f=c*M,l=(a-f)/N,l=Math.floor(l),d=l*N,f=a-f-d);b.rgb=a;b.r=c;b.g=l;b.b=f}function n(b,e,a,c){var f,l;f=Jb;f.rgb=0;f.r=null;f.g=null;f.b=null;f.str="";l=d(e);if(void 0!==a||void 0!==c)if("number"===l||"undefined"===l||e===PS.CURRENT||e===PS.DEFAULT){if(b=q(b,f,e,a,c),b===PS.ERROR)return PS.ERROR}else return"array"===l?h(b+"Extraneous arguments after color array"):"object"===l?h(b+"Extraneous arguments after color object"):
h(b+"red argument invalid");else if("number"===l)t(f,e);else if("array"===l)if(l=e.length,1>l)f.rgb=PS.CURRENT;else{if(b=q(b,f,e[0],e[1],e[2]),b===PS.ERROR)return PS.ERROR}else if("object"===l)if(a=e.rgb,l=d(a),"undefined"===l||null===a){if(b=q(b,f,e.r,e.g,e.b),b===PS.ERROR)return PS.ERROR}else if("number"===l)t(f,a);else if(a===PS.CURRENT||a===PS.DEFAULT)f.rgb=a;else return h(b+".rgb property invalid");else if("undefined"===l||e===PS.CURRENT)f.rgb=PS.CURRENT;else if(e===PS.DEFAULT)f.rgb=PS.DEFAULT;
else return h(b+"color argument invalid");return f}function U(b){var e,a;e=r.bead_size;b.glyph.x=Math.floor(e/2);a=b.glyph.scale;a=100>a?Math.floor(e*a/100):e;b.glyph.size=Math.floor(a/2);b.glyph.font=b.glyph.size+"pt sans-serif";b.glyph.y=Math.floor((e-a)/2)+Math.floor(a/7*4)}function gb(b){var e;m(u.bead,b);e={};m(u.bead.color,e);b.planes=[{height:0,color:e}];U(b);aa(b.fader);aa(b.borderFader);aa(b.glyphFader)}function Fa(b,e){var a,c,f,l,d;a=b.planes;if(1>e)return c=a[0],c.color;f=a.length;for(l=
1;l<f;l+=1)if(c=a[l],c.height===e)return c.color;c=u.bead.color;d={rgb:c.rgb,r:c.r,g:c.g,b:c.b,a:0};if(b.active){for(l=0;l<f;){c=a[l];if(c.height>e)break;l+=1}a.splice(l,0,{height:e,color:d})}return d}function hb(b){return 0<b.glyph.code?b.border.gmax:b.border.max}function K(b,e){b.border.equal=!0;b.border.width=e;b.border.top=e;b.border.left=e;b.border.bottom=e;b.border.right=e}function ib(b){var e,a,c;e=r.bead_size;100>b.scale?(a=Math.floor(e*b.scale/100),c=e-a,0<c&&c%2&&(a+=1)):(a=e,b.margin=0,
b.senseLeft=b.left,b.senseRight=b.right,b.senseTop=b.top,b.senseBottom=b.bottom);b.size=a;a!==e&&(b.margin=e=Math.floor((e-a)/2),b.senseLeft=b.left+e,b.senseRight=b.right-e,b.senseTop=b.top+e,b.senseBottom=b.bottom-e);e=b.border;e.max=Math.floor((a-8)/2);e.gmax=Math.floor((a-b.glyph.size)/2);a=hb(b);e.equal?e.width>a&&K(b,a):(b=e.top,b>a&&(e.top=a),b=e.left,b>a&&(e.left=a),b=e.bottom,b>a&&(e.bottom=a),b=e.right,b>a&&(e.right=a))}function Xa(b){b=b.data;null===b&&(b=0);return b}function mb(b){var e,
a;if(b.active){a=!1;e=Xa(b);if(b.exec)try{b.exec(b.x,b.y,e,ba),a=!0}catch(c){return F("Bead "+b.x+", "+b.y+" function failed ["+c.message+"]",c)}if(PS.touch)try{PS.touch(b.x,b.y,e,ba),a=!0}catch(f){return F("PS.touch() failed ["+f.message+"]",f)}a&&Q()}return PS.DONE}function nb(b){var e;if(b.active&&PS.release){e=Xa(b);try{PS.release(b.x,b.y,e,ba),Q()}catch(a){return F("PS.release() failed ["+a.message+"]",a)}}return PS.DONE}function ob(b){var e;pa=!0;if(b.active&&PS.enter){e=Xa(b);try{PS.enter(b.x,
b.y,e,ba),Q()}catch(a){return F("PS.enter() failed ["+a.message+"]",a)}}return PS.DONE}function Pa(b){var e;if(b.active&&PS.exit){e=Xa(b);try{PS.exit(b.x,b.y,e,ba),Q()}catch(a){return F("PS.exit() failed ["+a.message+"]",a)}}return PS.DONE}function pb(){pa=!1;if(PS.exitGrid)try{PS.exitGrid(ba),Q()}catch(b){return F("PS.exitGrid() failed ["+b.message+"]",b)}return PS.DONE}function Ga(b,e){var a,c,f;a=r.canvas.getBoundingClientRect();b-=a.left;e-=a.top;if(b>=r.left&&b<r.right&&e>=r.top&&e<r.bottom)for(c=
0;c<r.count;){a=A[c];if(e>=a.top&&e<a.bottom){for(f=0;f<r.x;f+=1){if(b>=a.senseLeft&&b<a.senseRight&&e>=a.senseTop&&e<a.senseBottom)return a;c+=1;a=A[c]}break}c+=r.x}return null}function Kb(b){var e,a;b.x&&b.y?(e=b.x,a=b.y):(e=b.clientX,a=b.clientY);(e=Ga(e,a))&&mb(e);return p(b)}function Lb(b){var e,a;b.x&&b.y?(e=b.x,a=b.y):(e=b.clientX,a=b.clientY);(e=Ga(e,a))&&nb(e);return p(b)}function Mb(b){var e,a;b.x&&b.y?(e=b.x,a=b.y):(e=b.clientX,a=b.clientY);(e=Ga(e,a))?e.index!==fa&&(0<=fa&&(a=A[fa],Pa(a)),
ob(e),fa=e.index):0<=fa&&(a=A[fa],Pa(a),fa=-1);return p(b)}function Nb(b){var e;0<=fa&&(e=A[fa],Pa(e),fa=-1);(e=b.relatedTarget)&&(e=e.id)&&(e===qb||e===jb||1>e.length)&&pb();return p(b)}function Ob(b){var e,a;b.preventDefault();if(Ha!==za)PS.debug("Finger already down\n");else return a=b.changedTouches[0],Ha=a.identifier,e=a.pageX,a=a.pageY,(e=Ga(e,a))?(pa=!0,ja=e.index,mb(e)):(ja=za,pa=!1),p(b)}function rb(b){var e,a,c,f;e=b.changedTouches.length;for(a=0;a<e;a+=1)if(c=b.changedTouches[a],f=c.identifier,
f===Ha){ja=Ha=za;pa=!1;e=c.pageX;c=c.pageY;(c=Ga(e,c))&&nb(c);break}return p(b)}function Pb(b){var e,a,c,f;b.preventDefault();e=b.changedTouches.length;for(a=0;a<e;a+=1)if(c=b.changedTouches[a],f=c.identifier,f===Ha){e=c.pageX;c=c.pageY;(c=Ga(e,c))?(pa=!0,ja!==c.index&&(ja!==za&&(e=A[ja],Pa(e)),ja=c.index,ob(c))):(ja!==za&&(e=A[ja],Pa(e)),ja=za,pa&&pb());break}return p(b)}function sb(b,e){var a;a=b;65<=a&&90>=a?e||(a+=32):(a=T[a],e&&256>a&&(a=J[a]));return a}function tb(b){return 32<=b||13===b||8===
b||9===b||27===b}function Qb(b){var e,a,c,f,l;e=!1;if(Ia)return!0;b.preventDefault();if(PS.keyDown){na=b.shiftKey;ua=b.ctrlKey;a=b.which?b.which:b.keyCode;c=sb(a,na);if(tb(c)){if(!ga[c]){ga[c]=1;c!==a&&ga[a]&&(ga[a]=0,l=X.indexOf(a),0<=l&&X.splice(l,1));1>X.length&&(Da=Qa);0>X.indexOf(c)&&X.push(c);try{PS.keyDown(c,na,ua,ba),e=!0}catch(d){F("[_keyDown] PS.keyDown failed ["+d.message+"]",d)}}}else if(c===ub)for(f=X.length,l=0;l<f;l+=1)if(c=a=X[l],97<=a&&122>=a?c-=32:256>a&&(c=J[a]),c!==a){ga[a]=0;
ga[c]=1;X[l]=c;try{PS.keyDown(c,!0,ua,ba),e=!0}catch(h){F("[_keyDown] PS.keyDown failed ["+h.message+"]",h)}}e&&Q()}return p(b)}function Rb(b){var e,a,c,f,l,d;e=!1;if(Ia)return!0;b.preventDefault();if(PS.keyUp){a=na=b.shiftKey;c=ua=b.ctrlKey;f=b.which?b.which:b.keyCode;l=sb(f,na);if(tb(l)){ga[l]=0;d=X.indexOf(l);0<=d&&X.splice(d,1);1>X.length&&(Da=0,ua=na=!1);try{PS.keyUp(l,a,c,ba),e=!0}catch(h){F("[_keyUp] PS.keyUp failed ["+h.message+"]",h)}}else if(l===ub)for(a=X.length,d=0;d<a;d+=1)if(l=f=X[d],
256>f&&(l=G[f]),l!==f){ga[f]=0;ga[l]=1;X[d]=l;try{PS.keyDown(l,!1,c,ba),e=!0}catch(v){F("[_keyUp] PS.keyDown failed ["+v.message+"]",v)}}e&&Q()}return p(b)}function vb(b){var e;if(!pa)return!0;if(PS.input){b||(b=window.event);e=Math.max(-1,Math.min(1,b.wheelDelta||-b.detail));e=1<=e?PS.WHEEL_FORWARD:PS.WHEEL_BACKWARD;try{PS.input({wheel:e},ba),Q()}catch(a){F("PS.input() failed ["+a.message+"]",a)}}return p(b)}function wb(b){var e,a,c,f,l;e=r.color;a=r.fader;c=b.rgb;if(c===PS.CURRENT)return e.rgb;
null===c?(c=b.r,c===PS.CURRENT?b.r=c=e.r:c===PS.DEFAULT&&(b.r=c=u.grid.color.r),f=b.g,f===PS.CURRENT?b.g=f=e.g:f===PS.DEFAULT&&(b.g=f=u.grid.color.g),l=b.b,l===PS.CURRENT?b.b=l=e.b:l===PS.DEFAULT&&(b.b=l=u.grid.color.b),b.rgb=c*M+f*N+l):c===PS.DEFAULT&&m(u.grid.color,b);if(e.rgb!==b.rgb||0<a.rate&&null!==a.rgb&&a.rgb!==b.rgb)e.rgb=b.rgb,c=b.r,f=b.g,l=b.b,e.str=b.str=ea[c]+Z[f]+xa[l],0<a.rate?null!==a.rgb?x(a,a.r,a.g,a.b,255,c,f,l,255):a.active?R(a,c,f,l,255):x(a,e.r,e.g,e.b,255,c,f,l,255):(S(b),w(b)),
e.r=c,e.g=f,e.b=l;return e.rgb}function xb(b,e){var a,c,f,l,d,h,v;ya=[];Ca=0;aa(r.fader);aa(ha.fader);r.plane=0;if(r.ready&&b===r.x&&e===r.y)for(c=0;c<r.count;c+=1)v=A[c],gb(v),ib(v);else{r.x=b;r.y=e;r.count=b*e;b>=e?(a=Math.floor(Ra/b),r.left=0):(a=Math.floor(Ra/e),r.left=Math.floor((Ra-a*b)/2));r.bead_size=a;r.width=a*b;r.height=a*e;r.right=r.left+r.width;r.top=0;r.bottom=r.height;r.canvas.height=e>=b?Ra:r.height;r.context.textAlign="center";r.context.textBaseline="middle";l=0;h=r.top;for(f=0;f<
e;f+=1){d=r.left;for(c=0;c<b;c+=1)v=A[l],v.x=c,v.y=f,v.left=d,v.right=d+a,v.top=h,v.bottom=h+a,gb(v),ib(v),d+=a,l+=1;h+=a}for(;l<yb;)v=A[l],v.visible=!1,v.active=!1,l+=1}Wa=!0;wb({rgb:PS.DEFAULT});PS.statusColor(PS.DEFAULT);Q();fa=-1;r.ready=!0}function zb(b,e){if("number"!==d(b))return h(e+"x argument not a number");b=Math.floor(b);return 0>b?h(e+"x argument negative"):b>=r.x?h(e+"x argument exceeds grid width"):b}function Ab(b,e){if("number"!==d(b))return h(e+"y argument not a number");b=Math.floor(b);
return 0>b?h(e+"y argument negative"):b>=r.y?h(e+"y argument exceeds grid height"):b}function Y(b,e,a,c,f,l,d,h){var v;if(a===PS.ALL){if(c===PS.ALL){for(c=0;c<r.y;c+=1)for(a=0;a<r.x&&(v=e(a,c,f,l,d,h),v!==PS.ERROR);a+=1);return v}c=Ab(c,b);if(c===PS.ERROR)return PS.ERROR;for(a=0;a<r.x&&(v=e(a,c,f,l,d,h),v!==PS.ERROR);a+=1);return v}if(c===PS.ALL){a=zb(a,b);if(a===PS.ERROR)return PS.ERROR;for(c=0;c<r.y&&(v=e(a,c,f,l,d,h),v!==PS.ERROR);c+=1);return v}a=zb(a,b);if(a===PS.ERROR)return PS.ERROR;c=Ab(c,
b);return c===PS.ERROR?PS.ERROR:v=e(a,c,f,l,d,h)}function Sb(b,e,a){var c,f,l,d,h;b=A[e*r.x+b];e=u.bead.color;c=Fa(b,r.plane);f=b.fader;l=a.rgb;if(!b.active||l===PS.CURRENT)return c.rgb;null===l?(l=a.r,l===PS.CURRENT?a.r=l=c.r:l===PS.DEFAULT&&(a.r=l=e.r),d=a.g,d===PS.CURRENT?a.g=d=c.g:d===PS.DEFAULT&&(a.g=d=e.g),h=a.b,h===PS.CURRENT?a.b=h=c.b:h===PS.DEFAULT&&(a.b=h=e.b),a.rgb=l*M+d*N+h):l===PS.DEFAULT&&m(e,a);if(c.rgb!==a.rgb||0<f.rate&&null!==f.rgb&&f.rgb!==a.rgb)c.rgb=a.rgb,c.r=a.r,c.g=a.g,c.b=
a.b,k(b);return c.rgb}function Tb(b,e,a){b=A[e*r.x+b];e=Fa(b,r.plane);b.active&&a!==PS.CURRENT&&a!==e.a&&(e.a=a,k(b));return e.a}function Sa(b,e){var a,c,f,l,D;a=d(e);if("undefined"===a||e===PS.CURRENT)return{rgb:PS.CURRENT,r:0,g:0,b:0,onEnd:PS.CURRENT,params:PS.CURRENT};if(e===PS.DEFAULT)return{rgb:PS.DEFAULT,r:0,g:0,b:0,onEnd:PS.DEFAULT,params:PS.DEFAULT};if("object"!==a)return h(b+"options argument invalid");c=e.rgb;if(c!==PS.CURRENT&&c!==PS.DEFAULT)if(a=d(c),"undefined"===a||null===c)e.rgb=PS.CURRENT;
else if("number"===a)c=Math.floor(c),c<=PS.COLOR_BLACK?(c=PS.COLOR_BLACK,f=l=a=0):c>=PS.COLOR_WHITE?(c=PS.COLOR_WHITE,f=l=a=255):(a=c/M,a=Math.floor(a),f=a*M,l=(c-f)/N,l=Math.floor(l),D=l*N,f=c-f-D),e.rgb=c,e.r=a,e.g=l,e.b=f;else return h(b+"options.rgb property invalid");else e.r=0,e.g=0,e.b=0;c=e.onEnd;if(c!==PS.CURRENT&&c!==PS.DEFAULT)if(a=d(c),"undefined"===a||null===c)e.onEnd=PS.CURRENT;else if("function"!==a)return h(b+"options.onEnd property invalid");c=e.params;if(c!==PS.CURRENT&&c!==PS.DEFAULT)if(a=
d(c),"undefined"===a||null===c)e.start=PS.CURRENT;else if("array"!==a)return h(b+"options.params property invalid");return e}function Ub(b,e,a,c){e=A[e*r.x+b];b=e.fader;e.active&&(a!==PS.CURRENT&&(b.rate=a===PS.DEFAULT?u.fader.rate:a),a=c.rgb,a!==PS.CURRENT&&(b.rgb=a===PS.DEFAULT?u.fader.rgb:a,b.r=c.r,b.g=c.g,b.b=c.b),a=c.onEnd,a!==PS.CURRENT&&(b.onEnd=a===PS.DEFAULT?u.fader.onEnd:a),a=c.params,a!==PS.CURRENT&&(b.params=a===PS.DEFAULT?u.fader.params:a));return{rate:b.rate,rgb:b.rgb,onEnd:b.onEnd,
params:b.params}}function Vb(b,e,a){b=A[e*r.x+b];b.active&&a!==PS.CURRENT&&b.scale!==a&&(b.scale=a,ib(b),V(b));return b.scale}function Wb(b,e,a){b=A[e*r.x+b];b.active&&a!==PS.CURRENT&&b.radius!==a&&(b.radius=a,!b.border.equal&&0<a&&(a=Math.max(b.border.top,b.border.left,b.border.bottom,b.border.right),K(b,a)),V(b));return b.radius}function Xb(b,e,a){b=A[e*r.x+b];b.active&&a!==PS.CURRENT&&(null===a?(b.data=u.bead.data,b.fader.data=b.data,b.borderFader.data=b.data,b.glyphFader.data=b.data):(b.data=
a,b.fader.data=a,b.borderFader.data=a,b.glyphFader.data=a));return b.data}function Yb(b,e,a){b=A[e*r.x+b];b.active&&a!==PS.CURRENT&&(b.exec=a);return b.exec}function Zb(b,e,a){b=A[e*r.x+b];b.active&&a!==PS.CURRENT&&b.visible!==a&&(b.visible=a,a||(b.fader.kill=!0,b.borderFader.kill=!0,b.glyphFader.kill=!0),V(b));return b.visible}function $b(b,e,a){b=A[e*r.x+b];a!==PS.CURRENT&&(b.active=a);return b.active}function ac(b,e,a){var c,f,l,D;b=A[e*r.x+b];b.active&&a!==PS.CURRENT&&(e=hb(b),"number"===d(a)?
(a>e&&(a=e),a!==b.border.width&&(K(b,a),V(b))):(c=!1,f=a.top,f===PS.CURRENT?f=b.border.top:(f>e&&(f=e),f!==b.border.top&&(b.border.top=f,c=!0)),l=a.left,l===PS.CURRENT?l=b.border.left:(l>e&&(l=e),l!==b.border.left&&(b.border.left=l,c=!0)),D=a.bottom,D===PS.CURRENT?D=b.border.bottom:(D>e&&(D=e),D!==b.border.bottom&&(b.border.bottom=D,c=!0)),a=a.right,a===PS.CURRENT?a=b.border.right:(a>e&&(a=e),a!==b.border.right&&(b.border.right=a,c=!0)),f===l&&f===a&&f===D?(K(b,f),c&&V(b)):0<b.radius||0<b.glyph.code?
(e=Math.max(f,l,D,a),K(b,e),V(b)):(b.border.equal=!1,c&&V(b))));a={top:b.border.top,left:b.border.left,bottom:b.border.bottom,right:b.border.right,equal:b.border.equal};b.border.equal||(b.border.width=Math.max(a.top,a.left,a.bottom,a.right));a.width=b.border.width;return a}function bc(b,e,a){var c,f,l,d,h;b=A[e*r.x+b];e=b.border.color;c=b.borderFader;f=a.rgb;b.active&&f!==PS.CURRENT&&(null===f?(f=a.r,f===PS.CURRENT?a.r=f=e.r:f===PS.DEFAULT&&(a.r=f=u.bead.border.color.r),l=a.g,l===PS.CURRENT?a.g=l=
e.g:l===PS.DEFAULT&&(a.g=l=u.bead.border.color.g),d=a.b,d===PS.CURRENT?a.b=d=e.b:d===PS.DEFAULT&&(a.b=d=u.bead.border.color.b),a.rgb=f*M+l*N+d):f===PS.DEFAULT&&m(u.bead.border.color,a),e.rgb!==a.rgb||0<c.rate&&null!==c.rgb&&c.rgb!==a.rgb)&&(e.rgb=a.rgb,f=a.r,l=a.g,d=a.b,a.a=h=e.a,e.str=a.str=ea[f]+Z[l]+Z[d]+ta[h],b.visible&&(0<c.rate?null!==c.rgb?x(c,c.r,c.g,c.b,h,f,l,d,h):c.active?R(c,f,l,d,h):x(c,e.r,e.g,e.b,h,f,l,d,h):V(b)),e.r=f,e.g=l,e.b=d);return e.rgb}function cc(b,e,a){var c,f,d,h;b=A[e*r.x+
b];e=b.border.color;b.active&&a!==PS.CURRENT&&a!==e.a&&(c=e.r,f=e.g,d=e.b,e.str=ea[c]+Z[f]+Z[d]+ta[a],b.visible&&(h=b.borderFader,0<h.rate?h.active?R(h,c,f,d,a):null!==h.rgb?x(h,h.r,h.g,h.b,e.a,c,f,d,a):x(h,c,f,d,e.a,c,f,d,a):V(b)),e.a=a);return e.a}function dc(b,e,a,c){e=A[e*r.x+b];b=e.borderFader;e.active&&(a!==PS.CURRENT&&(b.rate=a===PS.DEFAULT?u.fader.rate:a),a=c.rgb,a!==PS.CURRENT&&(b.rgb=a===PS.DEFAULT?u.fader.rgb:a,b.r=c.r,b.g=c.g,b.b=c.b),a=c.onEnd,a!==PS.CURRENT&&(b.onEnd=a===PS.DEFAULT?
u.fader.onEnd:a),a=c.params,a!==PS.CURRENT&&(b.params=a===PS.DEFAULT?u.fader.params:a));return{rate:b.rate,rgb:b.rgb,onEnd:b.onEnd,params:b.params}}function ec(b,e,a){var c,f,d;b=A[e*r.x+b];b.active&&a!==PS.CURRENT&&b.glyph.code!==a&&(b.glyph.code=a,a=1>a?"":String.fromCodePoint(a),b.glyph.str=a,a=hb(b),b.border.equal?b.border.width>a&&K(b,a):(e=b.border.top,e>a&&(e=a),c=b.border.left,c>a&&(c=a),f=b.border.bottom,f>a&&(f=a),d=b.border.right,d>a&&(d=a),a=Math.max(e,c,f,d),K(b,a)),V(b));return b.glyph.code}
function fc(b,e,a){var c,f,d,h,k;b=A[e*r.x+b];e=b.glyph.color;c=b.glyphFader;f=a.rgb;b.active&&f!==PS.CURRENT&&(null===f?(f=a.r,f===PS.CURRENT?a.r=f=e.r:f===PS.DEFAULT&&(a.r=f=u.bead.glyph.color.r),d=a.g,d===PS.CURRENT?a.g=d=e.g:d===PS.DEFAULT&&(a.g=d=u.bead.glyph.color.g),h=a.b,h===PS.CURRENT?a.b=h=e.b:h===PS.DEFAULT&&(a.b=h=u.bead.glyph.color.b),a.rgb=f*M+d*N+h):f===PS.DEFAULT&&m(u.bead.glyph.color,a),e.rgb!==a.rgb||0<c.rate&&null!==c.rgb&&c.rgb!==a.rgb)&&(e.rgb=a.rgb,f=a.r,d=a.g,h=a.b,a.a=k=e.a,
e.str=a.str=ea[f]+Z[d]+Z[h]+ta[k],b.visible&&(0<c.rate?(null!==c.rgb&&x(c,c.r,c.g,c.b,k,f,d,h,k),c.active?R(c,f,d,h,k):x(c,e.r,e.g,e.b,k,f,d,h,k)):V(b)),e.r=f,e.g=d,e.b=h);return e.rgb}function gc(b,e,a){var c,f,d,h;b=A[e*r.x+b];e=b.glyph.color;b.active&&a!==PS.CURRENT&&a!==e.a&&(c=e.r,f=e.g,d=e.b,e.str=ea[c]+Z[f]+Z[d]+ta[a],b.visible&&(h=b.glyphFader,0<h.rate?h.active?R(h,c,f,d,a):x(h,c,f,d,e.a,c,f,d,a):V(b)),e.a=a);return e.a}function hc(b,e,a){b=A[e*r.x+b];e=b.glyph.scale;b.active&&a!==PS.CURRENT&&
a!==e&&(b.glyph.scale=a,b.visible&&(U(b),V(b)));return b.glyph.scale}function ic(b,e,a,c){e=A[e*r.x+b];b=e.glyphFader;e.active&&(a!==PS.CURRENT&&(b.rate=a===PS.DEFAULT?u.fader.rate:a),a=c.rgb,a!==PS.CURRENT&&(b.rgb=a===PS.DEFAULT?u.fader.rgb:a,b.r=c.r,b.g=c.g,b.b=c.b),a=c.onEnd,a!==PS.CURRENT&&(b.onEnd=a===PS.DEFAULT?u.fader.onEnd:a),a=c.params,a!==PS.CURRENT&&(b.params=a===PS.DEFAULT?u.fader.params:a));return{rate:b.rate,rgb:b.rgb,onEnd:b.onEnd,params:b.params}}function jc(b,e){var a,c,f,l,D,k,v,
E,g,q;a=b.width;if("number"!==d(a)||1>a)return h("[_imageExtract] image width invalid");a=Math.floor(a);c=b.height;if("number"!==d(c)||1>c)return h("[_imageExtract] image height invalid");c=Math.floor(c);try{Ta.width=a,Ta.height=c,f=Ta.getContext("2d"),f.drawImage(b,0,0,a,c,0,0,a,c)}catch(s){return F("[_imageExtract] image extraction failed @ 1 ["+s.message+"]",s)}try{l=f.getImageData(0,0,a,c)}catch(m){return F("[_imageExtract] image extraction failed @ 2 ["+m.message+"]",m)}a={width:l.width,height:l.height};
l=l.data;c=l.length;f=[];k=D=0;if(1===e)for(f.length=c/4;D<c;)v=l[D],E=l[D+1],g=l[D+2],f[k]=v*M+E*N+g,D+=4,k+=1;else if(2===e)for(f.length=c/2;D<c;)v=l[D],E=l[D+1],g=l[D+2],q=l[D+3],f[k]=v*M+E*N+g,f[k+1]=q,D+=4,k+=2;else if(3===e)for(f.length=c/4*3;D<c;)v=l[D],E=l[D+1],g=l[D+2],f[k]=v,f[k+1]=E,f[k+2]=g,D+=4,k+=3;else for(f.length=c;D<c;)f[D]=l[D],D+=1,f[D]=l[D],D+=1,f[D]=l[D],D+=1,f[D]=l[D],D+=1;a.pixelSize=e;a.data=f;return a}function Ya(b,e){var a,c,f,l,D;if("object"!==d(e))return h(b+"image argument not an object");
a=e.width;if("number"!==d(a))return h(b+"image.width not a number");a=Math.floor(a);if(1>a)return h(b+"image.width < 1");e.width=a;c=e.height;if("number"!==d(c))return h(b+"image.height not a number");c=Math.floor(c);if(1>c)return h(b+"image.height < 1");e.height=c;f=e.pixelSize;if("number"!==d(f))return h(b+"image.pixelSize not a number");f=Math.floor(f);if(1>f&&4<f)return h(b+"image.pixelSize is not 1, 2, 3 or 4");e.pixelSize=f;l=e.data;if("array"!==d(l))return h(b+"image.data is not an array");
D=l.length;if(D!==a*c*f)return h(b+"image.data length invalid");for(a=0;a<D;a+=1){c=l[a];if("number"!==d(c))return h(b+"image.data["+a+"] not a number");if(0>c)return h(b+"image.data["+a+"] negative");if(3>f){if(16777215<c)return h(b+"image.data["+a+"] > 0xFFFFFF")}else if(255<c)return h(b+"image.data["+a+"] > 255")}return!0}function Ja(b,e){var a,c;a=b.toString(16).toUpperCase();if(e)for(c=a.length;c<e;)a="0"+a,c+=1;return"0x"+a}function Bb(){var b;b={id:kc+Za,placed:!1,visible:!0,x:0,y:0,ax:0,ay:0,
image:null,color:null,collide:null,width:0,height:0,plane:-1};Za+=1;qa.push(b);return b}function Aa(b,e){var a,c,f;if("string"!==typeof b||1>b.length)return h(e+"sprite argument invalid");a=qa.length;for(c=0;c<a;c+=1)if(f=qa[c],f.id===b)return f;return h(e+"sprite id '"+b+"' does not exist")}function va(b,e,a,c,f){var d,h,g,v;void 0===e&&(e=b.x,a=b.y,c=b.width,f=b.height);d=r.x;e-=b.ax;if(!(e>=d)){if(0>e){c+=e;if(1>c)return;e=0}e+c>d&&(c=d-e);c=e+c;h=r.y;a-=b.ay;if(!(a>=h)){if(0>a){f+=a;if(1>f)return;
a=0}a+f>h&&(f=h-a);f=a+f;for(h=a;h<f;h+=1)for(a=e;a<c;a+=1)g=a+h*d,g=A[g],g.active&&(v=Fa(g,b.plane),v.r=255,v.g=255,v.b=255,v.a=0,v.rgb=16777215,k(g))}}}function Ka(b){var e,a,c,f,d,h,g,v,E,q,s,m,n,t,p,z;e=b.width;a=b.height;if(!(1>e||1>a||(c=r.x,g=0,d=b.x-b.ax,d>=c))){if(0>d){e+=d;if(1>e)return;d=0;g=b.width-e}d+e>c&&(e=c-d);e=d+e;f=r.y;v=0;h=b.y-b.ay;if(!(h>=f)){if(0>h){a+=h;if(1>a)return;h=0;v=b.height-a}h+a>f&&(a=f-h);a=h+a;if(E=b.color)for(f=h;f<a;f+=1)for(h=d;h<e;h+=1)q=h+f*c,q=A[q],q.active&&
(s=Fa(q,b.plane),s.rgb=E.rgb,s.r=E.r,s.g=E.g,s.b=E.b,s.a=E.a,k(q));else for(E=b.image.data,f=h;f<a;f+=1){m=4*(v*b.width+g);for(h=d;h<e;h+=1)q=h+f*c,q=A[q],q.active&&(n=E[m],t=E[m+1],p=E[m+2],z=E[m+3],s=Fa(q,b.plane),s.rgb=n*M+t*N+p,s.r=n,s.g=t,s.b=p,s.a=z,k(q)),m+=4;v+=1}}}}function $a(b,e){var a,c,f,d,h,k,v,g,q,s,m,n,t,p,r,u,I;f=b.x-b.ax;d=b.y-b.ay;h=b.width;k=b.height;v=b.collide;a=qa.length;for(c=0;c<a;c+=1)if(g=qa[c],q=g.id,q!==e&&g.visible&&g.placed){s=g.x-g.ax;m=g.y-g.ay;n=g.width;t=g.height;
p=g.collide;r=s>f?s-f:f-s;u=m>d?m-d:d-m;I=null;if(f===s-h||f===s+n){if(d<=m&&u<=k||d>=m&&u<=t)I=PS.SPRITE_TOUCH}else if(d===m-k||d===m+t){if(f<=s&&r<=h||f>=s&&r<=n)I=PS.SPRITE_TOUCH}else if(f>=s&&f<s+n){if(d<=m&&u<k||d>=m&&u<t)I=PS.SPRITE_OVERLAP}else s>=f&&s<f+h&&(m<=d&&u<t||m>=d&&u<k)&&(I=PS.SPRITE_OVERLAP);if(I){if(v)try{v(e,b.plane,q,g.plane,I)}catch(H){F("[_collisionCheck] "+e+" collide function failed ["+H.message+"]",H);break}if(p)try{p(q,g.plane,e,b.plane,I)}catch(P){F("[_collisionCheck] "+
q+" collide function failed ["+P.message+"]",P);break}}}}function Cb(b){this.content=[];this.scoreFunction=b}function Db(b,e,a,c){b=a>b?a-b:b-a;e=c>e?c-e:e-c;return b>e?e*La+(b-e):b*La+(e-b)}function lc(b){return b.f}function kb(b){var e,a,c;e=Ba.length;for(a=0;a<e;a+=1)if(c=Ba[a],c.id===b)return c;return null}function mc(){var b,e,a,c,f;b=window.navigator.userAgent.toLowerCase();e=window.navigator.platform.toLowerCase();if(/firefox/.test(b))a="Firefox",/fennec/.test(b)&&(a+=" Mobile"),f=/firefox\/[\.\d]+/.exec(b)[0].split("/")[1];
else if(/chrome/.test(b))a="Chrome",f=/chrome\/[\d\.]+/.exec(b)[0].split("/")[1];else if(/safari/.test(b)){if(a="Safari",/iphone/.test(b)||/ipad/.test(b)||/ipod/.test(b))c="iOS"}else/msie/.test(b)?(a="Internet Explorer",/iemobile/.test(b)&&(a+=" Mobile"),f=/msie \d+[.]\d+/.exec(b)[0].split(" ")[1]):/trident/.test(b)?(a="Internet Explorer",f=/rv\:\d+[.]\d+/.exec(b)[0].split(":")[1]):/opera/.test(b)?(a="Opera",/mini/.test(b)?a+=" Mini":/mobile/.test(b)&&(a+=" Mobile")):/android/.test(b)&&(a="Android",
c=/android\s[\.\d]+/.exec(b));if(!f)try{f=(f=/version\/[\.\d]+/.exec(b))?f[0].split("/")[1]:/opera\/[\.\d]+/.exec(b)[0].split("/")[1]}catch(d){console.error("Problem detecting browser: "+d.message),f="???"}if("win32"===e||"win64"===e)c="Windows";else if("macintel"===e||"macppc"===e)c="Mac OS X "+/10[\.\_\d]+/.exec(b)[0],/[\_]/.test(c)&&(c=c.split("_").join("."));c||(/linux/.test(e)?c="Linux":/windows/.test(b)&&(c="Windows"));da.host.app=a;f&&(da.host.version=f);da.host.os=c}var qb="outer",jb="main",
kc="sprite_",Ra=512,nc=1/255,M=65536,N=256,yb=1024,ba={},ub=16,za=-1,fb=4,La=1.4142,Eb="a0 bb0 b0 c1 db1 d1 eb1 e1 f1 gb1 g1 ab1 a1 bb1 b1 c2 db2 d2 eb2 e2 f2 gb2 g2 ab2 a2 bb2 b2 c3 db3 d3 eb3 e3 f3 gb3 g3 ab3 a3 bb3 b3 c4 db4 d4 eb4 e4 f4 gb4 g4 ab4 a4 bb4 b4 c5 db5 d5 eb5 e5 f5 gb5 g5 ab5 a5 bb5 b5 c6 db6 d6 eb6 e6 f6 gb6 g6 ab6 a6 bb6 b6 c7 db7 d7 eb7 e7 f7 gb7 g7 ab7 a7 bb7 b7 c8".split(" "),Fb="a2 bb2 b2 c3 db3 d3 eb3 e3 f3 gb3 g3 ab3 a3 bb3 b3 c4 db4 d4 eb4 e4 f4 gb4 g4 ab4 a4 bb4 b4 c5 db5 d5 eb5 e5 f5 gb5 g5 ab5 a5 bb5 b5 c6 db6 d6 eb6 e6 f6 gb6 g6 ab6 a6 bb6 b6 c7 db7 d7 eb7 e7 f7".split(" "),
Gb="a4 bb4 b4 c5 db5 d5 eb5 e5 f5 gb5 g5 ab5 a5 bb5 b5 c6 db6 d6 eb6 e6 f6 gb6 g6 ab6 a6 bb6 b6 c7 db7 d7 eb7 e7 f7 gb7 g7 ab7 a7 bb7 b7".split(" "),u={grid:{x:8,y:8,max:32,plane:0,color:{r:255,g:255,b:255,a:255,rgb:16777215,str:"rgba(255,255,255,1)"},ready:!1},status:{text:"",color:{r:0,g:0,b:0,a:255,rgb:0,str:"rgba(0,0,0,1)"}},fader:{rate:0,rgb:null,onEnd:null,params:null},bead:{dirty:!0,active:!0,visible:!0,planes:null,color:{r:255,g:255,b:255,a:255,rgb:16777215,str:"rgba(255,255,255,1)"},radius:0,
scale:100,data:0,exec:null,border:{width:1,equal:!0,top:1,left:1,bottom:1,right:1,color:{r:128,g:128,b:128,a:255,rgb:8421504,str:"rgba(128,128,128,1)"}},glyph:{str:"",code:0,scale:100,size:0,x:0,y:0,font:null,color:{r:0,g:0,b:0,a:255,rgb:0,str:"rgba(0,0,0,1)"}}},audio:{volume:0.5,max_volume:1,path:"http://users.wpi.edu/~bmoriarty/ps/audio/",loop:!1,error_sound:"fx_uhoh"}},da={engine:"Perlenspiel",major:3,minor:1,revision:0,host:{app:"Unknown App",version:"?",os:"Unknown OS"},inputs:{touch:!1}},ea,
Z,xa,ta,r,A,ha,Wa=!1,Ta,wa,ma,qa,Za,db,oa,ab,ya,Ca,T,J,G,ga,X,na,ua,Na,Da,Oa,Qa,Ua,Ha,ja,pa,fa=-1,bb,Ia,Va,eb,Ba,cb,lb={rgb:0,r:0,g:0,b:0,str:""},Hb=!0,Ib=!1,Ea={rgb:0,r:0,g:0,b:0,str:""},Jb={rgb:0,r:null,g:null,b:null,str:""};Cb.prototype={push:function(b){this.content.push(b);this.bubbleUp(this.content.length-1)},pop:function(){var b,e;b=this.content[0];e=this.content.pop();0<this.content.length&&(this.content[0]=e,this.sinkDown(0));return b},remove:function(b){var e,a;e=this.content.length;for(a=
0;a<e;a+=1)if(this.content[a]===b){b=this.content.pop();a!==e-1&&(this.content[a]=b,this.bubbleUp(a),this.sinkDown(a));break}},size:function(){return this.content.length},bubbleUp:function(b){var e,a,c,f;e=this.content[b];for(a=this.scoreFunction(e);0<b;){c=Math.floor((b+1)/2)-1;f=this.content[c];if(a>=this.scoreFunction(f))break;this.content[c]=e;this.content[b]=f;b=c}},sinkDown:function(b){var e,a,c,f,d,h,k;e=this.content.length;a=this.content[b];for(c=this.scoreFunction(a);;){d=2*(b+1);f=d-1;h=
null;f<e&&(k=this.content[f],k=this.scoreFunction(k),k<c&&(h=f));d<e&&(f=this.content[d],f=this.scoreFunction(f),f<(null===h?c:k)&&(h=d));if(null===h)break;this.content[b]=this.content[h];this.content[h]=a;b=h}},rescore:function(b){this.sinkDown(this.content.indexOf(b))}};PS={ALL:"PS.ALL",CURRENT:"PS.CURRENT",DONE:"PS.DONE",DEFAULT:"PS.DEFAULT",ERROR:"PS.ERROR",EMPTY:"PS.EMPTY",UNEQUAL:"PS.UNEQUAL",GRID:"PS.GRID",STATUS:"PS.STATUS",HTML5_AUDIO:"PS.HTML5_AUDIO",WEB_AUDIO:"PS.WEB_AUDIO",SPRITE_TOUCH:"PS.SPRITE_TOUCH",
SPRITE_OVERLAP:"PS.SPRITE_OVERLAP",COLOR_BLACK:0,COLOR_WHITE:16777215,COLOR_GRAY_LIGHT:12632256,COLOR_GRAY:8421504,COLOR_GRAY_DARK:4210752,COLOR_RED:16711680,COLOR_ORANGE:16744448,COLOR_YELLOW:16776960,COLOR_GREEN:65280,COLOR_BLUE:255,COLOR_INDIGO:4194559,COLOR_VIOLET:8388863,COLOR_MAGENTA:16711935,COLOR_CYAN:65535,ALPHA_OPAQUE:255,ALPHA_TRANSPARENT:0,KEY_TAB:9,KEY_ESCAPE:27,KEY_PAGE_UP:1001,KEY_PAGE_DOWN:1002,KEY_END:1003,KEY_HOME:1004,KEY_ARROW_LEFT:1005,KEY_ARROW_UP:1006,KEY_ARROW_RIGHT:1007,KEY_ARROW_DOWN:1008,
KEY_INSERT:1009,KEY_DELETE:1010,KEY_PAD_0:96,KEY_PAD_1:97,KEY_PAD_2:98,KEY_PAD_3:99,KEY_PAD_4:100,KEY_PAD_5:101,KEY_PAD_6:102,KEY_PAD_7:103,KEY_PAD_8:104,KEY_PAD_9:105,KEY_F1:112,KEY_F2:113,KEY_F3:114,KEY_F4:115,KEY_F5:116,KEY_F6:117,KEY_F7:118,KEY_F8:119,KEY_F9:120,KEY_F10:121,WHEEL_FORWARD:"PS.WHEEL_FORWARD",WHEEL_BACKWARD:"PS.WHEEL_BACKWARD",FINDER_ASTAR:"PS.FINDER_ASTAR",FINDER_BREADTH_FIRST:"PS.FINDER_BREADTH_FIRST",FINDER_BEST_FIRST:"PS.FINDER_BEST_FIRST",FINDER_DIJKSTRA:"PS.FINDER_DIJKSTRA",
FINDER_BI_ASTAR:"PS.FINDER_BI_ASTAR",FINDER_BI_BEST_FIRST:"PS.FINDER_BI_BEST_FIRST",FINDER_BI_DIJKSTRA:"PS.FINDER_BI_DIJKSTRA",FINDER_BI_BREADTH_FIRST:"PS.FINDER_BI_BREADTH_FIRST",FINDER_JUMP_POINT:"PS.FINDER_JUMP_POINT",_lastTick:0,_clock:function(){db&&(window.requestAnimationFrame(PS._clock),s())},_sys:function(){var b,e,a,c,f,d;String.fromCodePoint||(String.fromCodePoint=B);ea=[];ea.length=256;Z=[];Z.length=256;xa=[];xa.length=256;ta=[];ta.length=256;for(b=0;256>b;b+=1)ea[b]="rgba("+b+",",Z[b]=
b+",",xa[b]=b+",1)",a=Math.floor(nc*b*1E3)/1E3,ta[b]=a+")";mc();try{document.createEvent("TouchEvent"),Ua=!0}catch(h){Ua=!1}da.inputs.touch=Ua;document.body.id="body";document.body.style.backgroundColor=u.grid.color.str;if(e=document.createElement("div"))if(e.id=qb,document.body.appendChild(e),b=document.createElement("div"))if(b.id=jb,e.appendChild(b),PS._mainLeft=b.offsetLeft,PS._mainTop=b.offsetTop,c=document.createElement("input"))if(c.type="text",c.readonly="readonly",c.onfocus=function(){this.blur()},
c.tabindex=-1,c.value="Perlenspiel 3.1",c.wrap="soft",c.id="status",b.appendChild(c),e=document.createElement("canvas"))if(e.id="grid",e.width=Ra,e.backgroundColor=u.grid.color.str,pa=!1,fa=-1,b.appendChild(e),f=document.createElement("p"))if(f.id="footer",f.innerHTML="Loading Perlenspiel",b.appendChild(f),Va=f,a=document.createElement("div"))if(a.id="debug",b.appendChild(a),b=document.createElement("textarea")){b.id="monitor";b.rows=8;b.wrap="soft";b.readonly="readonly";b.onfocus=function(){Ia=!0};
b.onblur=function(){Ia=!1};a.appendChild(b);Ia=bb=!1;ga=[];T=[];J=[];G=[];for(b=0;256>b;b+=1)ga[b]=0,T[b]=b,J[b]=b,G[b]=b;X=[];ua=na=!1;Na=!0;Oa=6;Qa=30;T[33]=PS.KEY_PAGE_UP;T[34]=PS.KEY_PAGE_DOWN;T[35]=PS.KEY_END;T[36]=PS.KEY_HOME;T[37]=PS.KEY_ARROW_LEFT;T[38]=PS.KEY_ARROW_UP;T[39]=PS.KEY_ARROW_RIGHT;T[40]=PS.KEY_ARROW_DOWN;T[45]=PS.KEY_INSERT;T[46]=PS.KEY_DELETE;T[188]=44;T[190]=46;T[191]=47;T[192]=96;T[219]=91;T[220]=92;T[221]=93;T[222]=39;J[96]=126;J[49]=33;J[50]=64;J[51]=35;J[52]=36;J[53]=37;
J[54]=94;J[55]=38;J[56]=42;J[57]=40;J[48]=41;J[45]=95;J[61]=43;J[91]=123;J[93]=125;J[92]=124;J[59]=58;J[39]=34;J[44]=60;J[46]=62;J[47]=63;for(b=65;91>b;b+=1)G[b]=b+32;G[126]=96;G[33]=49;G[64]=50;G[35]=51;G[36]=52;G[37]=53;G[94]=54;G[38]=55;G[42]=56;G[40]=57;G[41]=48;G[95]=45;G[43]=51;G[123]=91;G[125]=93;G[124]=92;G[58]=59;G[34]=39;G[60]=44;G[62]=46;G[63]=47;window.onblur=function(){var a;X.length=0;ua=na=!1;for(a=0;256>a;a+=1)ga[a]=0};b=e.getContext("2d");b.constructor.prototype.fillRoundedRect||
(b.constructor.prototype.fillRoundedRect=function(a,b,c,e,f,d,l){void 0===f&&(f=5);this.beginPath();"Opera"===da.host.app?(this.moveTo(a+c-f,b),this.arcTo(a+f,b,a,b+f,f),this.arcTo(a,b+e-f,a+f,b+e,f),this.arcTo(a+c-f,b+e,a+c,b+e-f,f),this.arcTo(a+c,b+f,a+c-f,b,f)):(this.moveTo(a+f,b),this.arcTo(a+c,b,a+c,b+e,f),this.arcTo(a+c,b+e,a,b+e,f),this.arcTo(a,b+e,a,b,f),this.arcTo(a,b,a+c,b,f));this.closePath();l&&this.stroke();(d||void 0===d)&&this.fill()});r={canvas:e,context:b,fader:la("grid",S,w)};m(u.grid,
r);A=[];A.length=a=yb;for(b=0;b<a;b+=1)d={index:b,fader:la(b,ra,null),borderFader:la(b,sa,null),glyphFader:la(b,Ma,null)},gb(d),A[b]=d;ha={div:c,fader:la("status",$,null)};m(u.status,ha);qa=[];Za=0;Ba=[];cb=0;c=AQ.init({defaultPath:u.audio.path,defaultFileTypes:["ogg","mp3","wav"],onAlert:PS.debug,stack:!0,forceHTML5:!0});if(c.status!==AQ.ERROR&&(eb=null,c=PS.audioLoad(u.audio.error_sound,{path:u.audio.path,lock:!0}),c===PS.ERROR?ca("Error sound '"+u.audio.error_sound+"' not loaded"):eb=u.audio.error_sound,
Ta=document.createElement("canvas"),b=Ta.getContext("2d"),b.imageSmoothingEnabled=!1,b.mozImageSmoothingEnabled=!1,b.webkitImageSmoothingEnabled=!1,wa=[],ma=0,c="() event function undefined","function"!==typeof PS.init&&(PS.init=null,ca("PS.init"+c)),"function"!==typeof PS.touch&&(PS.touch=null,ca("PS.touch"+c)),"function"!==typeof PS.release&&(PS.release=null,ca("PS.release"+c)),"function"!==typeof PS.enter&&(PS.enter=null,ca("PS.enter"+c)),"function"!==typeof PS.exit&&(PS.exit=null,ca("PS.exit()"+
c)),"function"!==typeof PS.exitGrid&&(PS.exitGrid=null,ca("PS.exitGrid"+c)),"function"!==typeof PS.keyDown&&(PS.keyDown=null,ca("PS.keyDown"+c)),"function"!==typeof PS.keyUp&&(PS.keyUp=null,ca("PS.keyUp"+c)),"function"!==typeof PS.input&&(PS.input=null,ca("PS.input"+c)),c=da.engine+" "+da.major+"."+da.minor+"."+da.revision+" | "+da.host.os+" "+da.host.app+" "+da.host.version,Ua&&(c+=" | Touch "),f.innerHTML=c,xb(u.grid.x,u.grid.y),ya=[],Ca=0,oa=[],ab=0,db=!0,PS._clock(),e.addEventListener("mousedown",
Kb,!1),e.addEventListener("mouseup",Lb,!1),e.addEventListener("mousemove",Mb,!1),e.addEventListener("mouseout",Nb,!1),document.addEventListener("keydown",Qb,!1),document.addEventListener("keyup",Rb,!1),window.addEventListener("DOMMouseScroll",vb,!1),window.addEventListener("mousewheel",vb,!1),Ua&&(ja=Ha=za,document.addEventListener("touchmove",Pb,!1),document.addEventListener("touchstart",Ob,!1),document.addEventListener("touchend",rb,!1),document.addEventListener("touchcancel",rb,!1)),PS.init))try{PS.init(da,
ba),Q()}catch(k){F("PS.init() failed ["+k.message+"]",k)}}else window.alert("[PS.sys] Invalid element");else window.alert("[PS.sys] Invalid element");else window.alert("[PS.sys] Invalid element");else window.alert("[PS.sys] HTML5 canvas not supported.");else window.alert("[PS.sys] Invalid element");else window.alert("[PS.sys] Invalid element");else window.alert("[PS.sys] Invalid element")},gridSize:function(b,e){var a,c,f;if(2<arguments.length)return h("[PS.gridSize] Too many arguments");a=b;c=e;
f=u.grid.max;if(a===PS.DEFAULT)a=u.grid.x;else if(a===PS.CURRENT)a=r.x;else if("number"===d(a))a=Math.floor(a),1>a?a=1:a>f&&(a=f);else return h("[PS.gridSize] x argument invalid");if(c===PS.DEFAULT)c=u.grid.y;else if(c===PS.CURRENT)c=r.y;else if("number"===d(c))c=Math.floor(c),1>c?c=1:c>f&&(c=f);else return h("[PS.gridSize] y argument invalid");xb(a,c);return{width:r.x,height:r.y}},gridPlane:function(b){var e,a;if(1<arguments.length)return h("[PS.gridPlane] Too many arguments");e=b;a=d(e);if("undefined"!==
a&&e!==PS.CURRENT){if(e===PS.DEFAULT)e=0;else if("number"===a)e=Math.floor(e),1>e&&(e=0);else return h("[PS.gridPlane] plane argument invalid");r.plane=e}return r.plane},gridColor:function(b,e,a){var c;if(3<arguments.length)return h("[PS.gridColor] Too many arguments");c=n("[PS.gridColor] ",b,e,a);return c===PS.ERROR?PS.ERROR:wb(c)},gridFade:function(b,e){var a,c,f;if(2<arguments.length)return h("[PS.gridFade] Too many arguments");a=r.fader;f=b;if(f!==PS.CURRENT&&(c=d(f),"undefined"!==c))if(f===PS.DEFAULT)a.rate=
u.fader.rate;else if("number"===c)f=Math.floor(f),0>f&&(f=0),a.rate=f;else return h("[PS.gridFade] rate argument invalid");c=Sa("[PS.gridFade] ",e);if(c===PS.ERROR)return PS.ERROR;f=c.rgb;f!==PS.CURRENT&&(a.rgb=f===PS.DEFAULT?u.fader.rgb:f,a.r=c.r,a.g=c.g,a.b=c.b);f=c.onEnd;f!==PS.CURRENT&&(a.onEnd=f===PS.DEFAULT?u.fader.onEnd:f);f=c.params;f!==PS.CURRENT&&(a.params=f===PS.DEFAULT?u.fader.params:f);return{rate:a.rate,rgb:a.rgb,onEnd:a.onEnd,params:a.params}},color:function(b,e,a,c,f){var d;d=arguments.length;
if(2>d)return h("[PS.color] Missing argument(s)");if(5<d)return h("[PS.color] Too many arguments");d=n("[PS.color] ",a,c,f);return d===PS.ERROR?PS.ERROR:Y("[PS.color] ",Sb,b,e,d)},alpha:function(b,e,a){var c,f;c=arguments.length;if(2>c)return h("[PS.alpha] Missing argument(s)");if(3<c)return h("[PS.alpha] Too many arguments");c=a;if(c!==PS.CURRENT)if(f=d(c),"undefined"===f)c=PS.CURRENT;else if("number"===f)c=Math.floor(c),0>c?c=0:255<c&&(c=255);else if(c===PS.DEFAULT)c=u.bead.color.a;else return h("[PS.alpha] alpha argument invalid");
return Y("[PS.alpha] ",Tb,b,e,c)},fade:function(b,e,a,c){var f,l;f=arguments.length;if(2>f)return h("[PS.fade] Missing argument(s)");if(4<f)return h("[PS.fade] Too many arguments");f=a;if(f!==PS.CURRENT&&f!==PS.DEFAULT)if(l=d(f),"undefined"===l)f=PS.CURRENT;else if("number"===l)f=Math.floor(f),0>f&&(f=0);else return h("[PS.fade] rate argument invalid");l=Sa("[PS.fade] ",c);return l===PS.ERROR?PS.ERROR:Y("[PS.fade] ",Ub,b,e,f,l)},scale:function(b,e,a){var c,f;c=arguments.length;if(2>c)return h("[PS.scale] Missing argument(s)");
if(3<c)return h("[PS.scale] Too many arguments");c=a;if(c!==PS.CURRENT)if(f=d(c),"undefined"===f)c=PS.CURRENT;else if(c===PS.DEFAULT)c=100;else if("number"===f)c=Math.floor(c),50>c?c=50:100<c&&(c=100);else return h("[PS.scale] scale parameter invalid");return Y("[PS.scale] ",Vb,b,e,c)},radius:function(b,e,a){var c,f;c=arguments.length;if(2>c)return h("[PS.radius] Missing argument(s)");if(3<c)return h("[PS.radius] Too many arguments");c=a;if(c!==PS.CURRENT)if(f=d(c),"undefined"===f)c=PS.CURRENT;else if(c===
PS.DEFAULT)c=0;else if("number"===f)c=Math.floor(c),0>c?c=0:50<c&&(c=50);else return h("[PS.radius] radius parameter invalid");return Y("[PS.radius] ",Wb,b,e,c)},data:function(b,e,a){var c;c=arguments.length;if(2>c)return h("[PS.data] Missing argument(s)");if(3<c)return h("[PS.data] Too many arguments");c=a;void 0===c?c=PS.CURRENT:c===PS.DEFAULT&&(c=null);return Y("[PS.data] ",Xb,b,e,c)},exec:function(b,e,a){var c,f;c=arguments.length;if(2>c)return h("[PS.exec] Missing argument(s)");if(3<c)return h("[PS.exec] Too many arguments");
c=a;if(c!==PS.CURRENT)if(f=d(c),"undefined"===f)c=PS.CURRENT;else if(c===PS.DEFAULT)c=u.bead.exec;else if("function"!==f)return h("[PS.exec] exec argument invalid");return Y("[PS.exec] ",Yb,b,e,c)},visible:function(b,e,a){var c;c=arguments.length;if(2>c)return h("[PS.visible] Missing argument(s)");if(3<c)return h("[PS.visible] Too many arguments");c=g(a,PS.CURRENT,!0,PS.CURRENT);return c===PS.ERROR?h("[PS.visible] show argument invalid"):Y("[PS.visible] ",Zb,b,e,c)},active:function(b,e,a){var c;c=
arguments.length;if(2>c)return h("[PS.active] Missing argument(s)");if(3<c)return h("[PS.active] Too many arguments");c=g(a,PS.CURRENT,!0,PS.CURRENT);return c===PS.ERROR?h("[PS.active] active argument invalid"):Y("[PS.active] ",$b,b,e,c)},border:function(b,e,a){var c,f,l,k;c=arguments.length;if(2>c)return h("[PS.border] Missing argument(s)");if(3<c)return h("[PS.border] Too many arguments");c=u.bead.border;f=a;if(f!==PS.CURRENT)if(l=d(f),"undefined"===l)f=PS.CURRENT;else if(f===PS.DEFAULT)f=c.width;
else if("number"===l)f=Math.floor(f),0>f&&(f=0);else if("object"===l){k=f.top;if(k!==PS.CURRENT)if(l=d(k),"undefined"===l)f.top=PS.CURRENT;else if("number"===l)k=Math.floor(k),0>k&&(k=0),f.top=k;else if(k===PS.DEFAULT)f.top=c.top;else return h("[PS.border] .top property invalid");k=f.left;if(k!==PS.CURRENT)if(l=d(k),"undefined"===l)f.left=PS.CURRENT;else if("number"===l)k=Math.floor(k),0>k&&(k=0),f.left=k;else if(k===PS.DEFAULT)f.left=c.left;else return h("[PS.border] .left property invalid");k=f.bottom;
if(k!==PS.CURRENT)if(l=d(k),"undefined"===l)f.bottom=PS.CURRENT;else if("number"===l)k=Math.floor(k),0>k&&(k=0),f.bottom=k;else if(k===PS.DEFAULT)f.bottom=c.bottom;else return h("[PS.border] .bottom property invalid");k=f.right;if(k!==PS.CURRENT)if(l=d(k),"undefined"===l)f.right=PS.CURRENT;else if("number"===l)k=Math.floor(k),0>k&&(k=0),f.right=k;else if(k===PS.DEFAULT)f.right=c.right;else return h("[PS.border] .right property invalid")}else return h("[PS.border] width argument invalid");return Y("[PS.border] ",
ac,b,e,f)},borderColor:function(b,e,a,c,f){var d;if(2>arguments.length)return h("[PS.borderColor] Missing argument(s)");if(5<arguments.length)return h("[PS.borderColor] Too many arguments");d=n("[PS.borderColor] ",a,c,f);return d===PS.ERROR?PS.ERROR:Y("[PS.borderColor] ",bc,b,e,d)},borderAlpha:function(b,e,a){var c,f;c=arguments.length;if(2>c)return h("[PS.borderAlpha] Missing argument(s)");if(3<c)return h("[PS.borderAlpha] Too many arguments");c=a;if(c!==PS.CURRENT)if(f=d(c),"undefined"===f)c=PS.CURRENT;
else if("number"===f)c=Math.floor(c),0>c?c=0:255<c&&(c=255);else if(c===PS.DEFAULT)c=u.bead.border.color.a;else return h("[PS.borderAlpha] alpha argument invalid");return Y("[PS.borderAlpha] ",cc,b,e,c)},borderFade:function(b,e,a,c){var f,l;f=arguments.length;if(2>f)return h("[PS.borderFade] Missing argument(s)");if(4<f)return h("[PS.borderFade] Too many arguments");f=a;if(f!==PS.CURRENT&&f!==PS.DEFAULT)if(l=d(f),"undefined"===l)f=PS.CURRENT;else if("number"===l)f=Math.floor(f),0>f&&(f=0);else return h("[PS.borderFade] rate argument not a number");
l=Sa("[PS.borderFade] ",c);return l===PS.ERROR?PS.ERROR:Y("[PS.borderFade] ",dc,b,e,f,l)},glyph:function(b,e,a){var c,f;c=arguments.length;if(2>c)return h("[PS.glyph] Missing argument(s)");if(3<c)return h("[PS.glyph] Too many arguments");c=a;if(c!==PS.CURRENT)if(f=d(c),"undefined"===f)c=PS.CURRENT;else if(c===PS.DEFAULT)c=0;else if("string"===f)c=0<c.length?c.charCodeAt(0):0;else if("number"===f)c=Math.floor(c),1>c&&(c=0);else return h("[PS.glyph] glyph argument invalid");return Y("[PS.glyph] ",ec,
b,e,c)},glyphColor:function(b,e,a,c,f){var d;if(2>arguments.length)return h("[PS.glyphColor] Missing argument(s)");if(5<arguments.length)return h("[PS.glyphColor] Too many arguments");d=n("[PS.glyphColor] ",a,c,f);return d===PS.ERROR?PS.ERROR:Y("[PS.glyphColor] ",fc,b,e,d)},glyphAlpha:function(b,e,a){var c,f;c=arguments.length;if(2>c)return h("[PS.glyphAlpha] Missing argument(s)");if(3<c)return h("[PS.glyphAlpha] Too many arguments");c=a;if(c!==PS.CURRENT)if(f=d(c),"undefined"===f)c=PS.CURRENT;else if("number"===
f)c=Math.floor(c),0>c?c=0:255<c&&(c=255);else if(c===PS.DEFAULT)c=u.bead.glyph.color.a;else return h("[PS.glyphAlpha] alpha argument invalid");return Y("[PS.glyphAlpha] ",gc,b,e,c)},glyphScale:function(b,e,a){var c,f;c=arguments.length;if(2>c)return h("[PS.glyphScale] Missing argument(s)");if(3<c)return h("[PS.glyphScale] Too many arguments");c=a;if(c!==PS.CURRENT)if(f=d(c),"undefined"===f)c=PS.CURRENT;else if("number"===f)c=Math.floor(c),50>c?c=50:100<c&&(c=100);else if(c===PS.DEFAULT)c=u.bead.glyph.scale;
else return h("[PS.glyphScale] scale argument invalid");return Y("[PS.glyphScale] ",hc,b,e,c)},glyphFade:function(b,e,a,c){var f,l;f=arguments.length;if(2>f)return h("[PS.glyphFade] Missing argument(s)");if(4<f)return h("[PS.glyphFade] Too many arguments");f=a;if(f!==PS.CURRENT&&f!==PS.DEFAULT)if(l=d(f),"undefined"===l)f=PS.CURRENT;else if("number"===l)f=Math.floor(f),0>f&&(f=0);else return h("[PS.glyphFade] rate argument not a number");l=Sa("[PS.glyphFade] ",c);return l===PS.ERROR?PS.ERROR:Y("[PS.glyphFade] ",
ic,b,e,f,l)},statusText:function(b){var e,a;if(1<arguments.length)return h("[PS.statusText] Too many arguments");e=b;a=d(e);e!==PS.CURRENT&&"undefined"!==a&&(e===PS.DEFAULT?e=u.status.text:"string"!==a&&(e=e.toString()),ha.div.value=ha.text=e);return ha.text},statusColor:function(b,e,a){var c,f,d,k,g,v;if(3<arguments.length)return h("[PS.statusColor] Too many arguments");c=n("[PS.statusColor] ",b,e,a);if(c===PS.ERROR)return PS.ERROR;f=ha.color;d=ha.fader;k=c.rgb;k!==PS.CURRENT&&(null===k?(k=c.r,k===
PS.CURRENT?c.r=k=f.r:k===PS.DEFAULT&&(c.r=k=u.status.color.r),g=c.g,g===PS.CURRENT?c.g=g=f.g:g===PS.DEFAULT&&(c.g=g=u.status.color.g),v=c.b,v===PS.CURRENT?c.b=v=f.b:v===PS.DEFAULT&&(c.b=v=u.status.color.b),c.rgb=k*M+g*N+v):k===PS.DEFAULT&&m(u.status.color,c),f.rgb!==c.rgb||0<d.rate&&null!==d.rgb&&d.rgb!==c.rgb)&&(f.rgb=c.rgb,k=c.r,g=c.g,v=c.b,f.str=c.str=ea[k]+Z[g]+xa[v],0<d.rate?(null!==d.rgb&&x(d,d.r,d.g,d.b,255,k,g,v,255),d.active?R(d,k,g,v,255):x(d,f.r,f.g,f.b,255,k,g,v,255)):$(f),f.r=k,f.g=g,
f.b=v);return f.rgb},statusFade:function(b,e){var a,c,f;if(2<arguments.length)return h("[PS.statusFade] Too many arguments");a=ha.fader;c=b;if(c!==PS.CURRENT&&(f=d(c),"undefined"!==f))if(c===PS.DEFAULT)a.rate=u.fader.rate;else if("number"===f)c=Math.floor(c),0>c&&(c=0),a.rate=c;else return h("[PS.statusFade] rate argument invalid");f=Sa("[PS.statusFade] ",e);if(f===PS.ERROR)return PS.ERROR;c=f.rgb;c!==PS.CURRENT&&(a.rgb=c===PS.DEFAULT?u.fader.rgb:c,a.r=f.r,a.g=f.g,a.b=f.b);c=f.onEnd;c!==PS.CURRENT&&
(a.onEnd=c===PS.DEFAULT?u.fader.onEnd:c);c=f.params;c!==PS.CURRENT&&(a.params=c===PS.DEFAULT?u.fader.params:c);return{rate:a.rate,rgb:a.rgb,onEnd:a.onEnd,params:a.params}},timerStart:function(b,e){var a,c,f,l;a=arguments.length;if(2>a)return h("[PS.timerStart] Argument(s) missing");c=b;if(c===PS.DEFAULT)c=60;else{f=d(c);if("number"!==f)return h("[PS.timerStart] ticks argument invalid");c=Math.floor(c);if(1>c)return h("[PS.timerStart] ticks argument less than one (1)")}if("function"!==typeof e)return h("[PS.timerStart] exec argument not a function");
f=[];if(2<a)for(l=a-2,f.length=l,a=0;a<l;a+=1)f[a]=arguments[a+2];a="timer_"+ab;ab+=1;oa.push({id:a,delay:c,count:c,exec:e,arglist:f});return a},timerStop:function(b){var e,a,c;if(1>arguments.length)return h("[PS.timerStop] Argument missing");if("string"!==typeof b||1>b.length)return h("[PS.timerStop] id argument invalid");a=oa.length;for(e=0;e<a;e+=1)if(c=oa[e],c.id===b)return oa.splice(e,1),b;return h("[PS.timerStop] timer id '"+b+"' not found")},random:function(b){var e;if(1>arguments.length)return h("[PS.random] Argument missing");
e=b;if("number"!==d(e))return h("[PS.random] Argument not a number");e=Math.floor(e);if(2>e)return 1;e*=Math.random();return e=Math.floor(e)+1},makeRGB:function(b,e,a){var c,f,l;c=arguments.length;if(3>c)return h("[PS.makeRGB] Argument(s) missing");if(3<c)return h("[PS.makeRGB] Too many arguments");c=b;f=e;l=a;if("number"!==d(c))return h("[PS.makeRGB] r argument not a number");c=Math.floor(c);0>c?c=0:255<c&&(c=255);if("number"!==d(f))return h("[PS.makeRGB] g argument not a number");f=Math.floor(f);
0>f?f=0:255<f&&(f=255);if("number"!==d(l))return h("[PS.makeRGB] b argument not a number");l=Math.floor(l);0>l?l=0:255<l&&(l=255);return c*M+f*N+l},unmakeRGB:function(b,e){var a,c,f,l,k;a=arguments.length;if(2>a)return h("[PS.unmakeRGB] Missing argument(s)");if(2<a)return h("[PS.unmakeRGB] Too many arguments");a=b;if("number"!==d(a))return h("[PS.unmakeRGB] rgb argument not a number");a=Math.floor(a);1>a?l=f=c=a=0:16777215<=a?(a=16777215,l=f=c=255):(c=a/M,c=Math.floor(c),l=c*M,f=(a-l)/N,f=Math.floor(f),
k=f*N,l=a-l-k);k=d(e);if("object"===k)e.rgb=a,e.r=c,e.g=f,e.b=l;else if("array"===k)3>e.length&&(e.length=3),e[0]=c,e[1]=f,e[2]=l;else return h("[PS.unmakeRGB] result argument not an array or object reference");return e},applyRect:function(b,e,a,c,f){var l,k,g,v,q,s,m,n;l=arguments.length;if(5>l)return h("[PS.applyRect] Argument(s) missing");k=r.x;g=r.y;v=b;q=e;s=a;m=c;if(v===PS.DEFAULT)v=0;else if("number"===d(v)){v=Math.floor(v);if(v>=k)return PS.DONE;0>v&&(v=0)}else return h("[PS.applyRect] left argument invalid");
if(q===PS.DEFAULT)q=0;else if("number"===d(q)){q=Math.floor(q);if(q>=g)return PS.DONE;0>q&&(q=0)}else return h("[PS.applyRect] top argument invalid");if(s===PS.DEFAULT)s=k-v;else if("number"===d(s)){s=Math.floor(s);if(1>s)return PS.DONE;v+s>k&&(s=k-v)}else return h("[PS.applyRect] width argument invalid");k=v+s;if(m===PS.DEFAULT)m=g-q;else if("number"===d(m)){m=Math.floor(m);if(1>m)return PS.DONE;q+m>g&&(m=g-q)}else return h("[PS.applyRect] height argument invalid");g=q+m;if(!f||"function"!==typeof f)return h("[PS.applyRect] exec argument not a function");
m=[0,0];if(5<l)for(l-=5,s=0;s<l;s+=1)m.push(arguments[s+5]);for(l=q;l<g;l+=1)for(m[1]=l,q=v;q<k;q+=1){m[0]=q;try{n=f.apply(ba,m)}catch(t){n=F("[PS.applyRect] exec failed @"+q+", "+l+" ["+t.message+"]",t)}if(n===PS.ERROR)return PS.ERROR}return n},hex:function(b,e){var a,c,f;a=b;c=d(a);if("number"!==c)return h("[PS.hex] value argument invalid");a=Math.floor(a);a=Math.abs(a);f=e;c=d(f);if("undefined"===c||f===PS.DEFAULT)f=2;else if("number"===c)f=Math.floor(f),1>f&&(f=1);else return h("[PS.hex] padding argument invalid");
for(a=Number(a).toString(16);a.length<f;)a="0"+a;return"0x"+a},keyRepeat:function(b,e,a){var c;b=g(b,Na,!0,!0);if(b===PS.ERROR)return h("[PS.keyRepeat] ","repeat argument invalid");c=e;e=d(c);if("undefined"===e||c===PS.DEFAULT)c=30;else if(c===PS.CURRENT)c=Qa;else if("number"===e)c=Math.floor(c),1>c&&(c=1);else return h("[PS.keyRepeat] ","init argument invalid");e=d(a);if("undefined"===e||a===PS.DEFAULT)a=6;else if(a===PS.CURRENT)a=Oa;else if("number"===e)a=Math.floor(a),1>a&&(a=1);else return h("[PS.keyRepeat] ",
"delay argument invalid");Na=b;Qa=c;Oa=a;return{repeat:Na,init:Qa,delay:Oa}},imageLoad:function(b,e,a){var c,f,l;c=arguments.length;if(2>c)return h("[PS.imageLoad] Missing argument(s)");if(3<c)return h("[PS.imageLoad] Too many argument(s)");c=a;if("string"!==typeof b||1>b.length)return h("[PS.imageLoad] filename argument invalid");f=b.substr(b.lastIndexOf(".")+1);f=f.toLowerCase();if("png"!==f&&"jpg"!==f&&"jpeg"!==f&&"bmp"!==f)return h("[PS.imageLoad] filename extension invalid");if("function"!==
typeof e)return h("[PS.imageLoad] exec argument invalid");f=d(c);if("undefined"===f||c===PS.DEFAULT)c=4;else{if("number"!==f)return h("[PS.imageLoad] format argument invalid");c=Math.floor(c);if(1>c&&4<c)return h("[PS.imageLoad] format argument is not 1, 2, 3 or 4")}f="image_"+ma;ma+=1;wa.push({source:b,id:f,exec:e,format:c});try{l=new Image,l.setAttribute("data-id",f),l.onload=function(){var a,b,c,e,f,d,h;a=l.getAttribute("data-id");b=wa.length;for(c=0;c<b;c+=1)if(e=wa[c],e.id===a){f=e.exec;d=e.format;
h=e.source;wa.splice(c,1);break}b=jc(l,d);if(b!==PS.ERROR)try{b.source=h,b.id=a,f(b)}catch(k){F("[PS.imageLoad] .exec function failed ["+k.message+"]",k)}},l.onerror=function(){var a,b,c,e,f;a=l.getAttribute("data-id");b=wa.length;for(c=0;c<b;c+=1)if(e=wa[c],e.id===a){f=e.exec;wa.splice(c,1);break}try{f(PS.ERROR)}catch(d){F("[PS.imageLoad] .exec function failed ["+d.message+"]",d)}h("[PS.imageLoad] Error loading "+l.src)},l.src=b}catch(k){return F("[PS.imageLoad] Error loading "+b+" ["+k.message+
"]",k)}return f},imageBlit:function(b,e,a,c){var f,l,g,q,v,s,m,n,t,p,L,W,z,u,I,H,P,w,x,B,y,U;f=arguments.length;if(3>f)return h("[PS.imageBlit] Missing argument(s)");if(4<f)return h("[PS.imageBlit] Too many arguments");f=r.x;l=r.y;g=e;q=a;if(Ya("[PS.imageBlit] ",b)===PS.ERROR)return PS.ERROR;v=b.width;s=b.height;m=b.pixelSize;n=b.data;t=d(g);if("undefined"===t||g===PS.DEFAULT)g=0;else if("number"===t)g=Math.floor(g);else return h("[PS.imageBlit] xpos argument invalid");t=d(q);if("undefined"===t||
q===PS.DEFAULT)q=0;else if("number"===t)q=Math.floor(q);else return h("[PS.imageBlit] ypos argument invalid");if(g>=f||q>=l||1>g+v||1>q+s)return!1;t=d(c);if("undefined"===t||c===PS.DEFAULT)L=p=0,W=v,z=s;else if("object"===t){L=c.left;t=d(L);if("undefined"===t||L===PS.DEFAULT)L=0;else{if("number"!==t)return h("[PS.imageBlit] region.left invalid");L=Math.floor(L);if(0>L)L=0;else if(L>=v)return h("[PS.imageBlit] region.left outside image")}p=c.top;t=d(p);if("undefined"===t||p===PS.DEFAULT)p=0;else{if("number"!==
t)return h("[PS.imageBlit] region.top invalid");p=Math.floor(p);if(0>p)p=0;else if(p>=s)return h("[PS.imageBlit] region.top outside image")}W=c.width;t=d(W);if("undefined"===t||W===PS.DEFAULT)W=v-L;else{if("number"!==t)return h("[PS.imageBlit] region.width invalid");W=Math.floor(W);if(1>W)return!1;L+W>v&&(W=v-L)}if(1>g+W)return!1;z=c.height;t=d(z);if("undefined"===t||z===PS.DEFAULT)z=s-p;else{if("number"!==t)return h("[PS.imageBlit] region.height invalid");z=Math.floor(z);if(1>z)return!1;p+z>s&&(z=
s-p)}if(1>q+z)return!1}else return h("[PS.imageBlit] region argument invalid");if(0>g){W+=g;if(1>W)return!1;L-=g;g=0}g+W>f&&(W=f-g);if(1>W)return!1;if(0>q){z+=q;if(1>z)return!1;p-=q;q=0}q+z>l&&(z=l-q);if(1>z)return!1;v*=m;t=!1;s=255;l=r.plane;p=p*v+L*m;u=q;for(I=0;I<z;I+=1){q=p;L=g;for(H=0;H<W;H+=1)P=L+u*f,U=A[P],U.active&&(t=!0,3>m?(B=n[q],P=B/M,P=Math.floor(P),x=P*M,w=(B-x)/N,w=Math.floor(w),y=w*N,x=B-x-y,2===m&&(s=n[q+1])):(P=n[q],w=n[q+1],x=n[q+2],B=P*M+w*N+x,4===m&&(s=n[q+3])),y=Fa(U,l),y.r=
P,y.g=w,y.b=x,y.a=s,y.rgb=B,k(U)),L+=1,q+=m;u+=1;p+=v}t&&Q();return!0},imageCapture:function(b,e){var a,c,f,l,k,g,q,s,m,n,t;if(2<arguments.length)return h("[PS.imageCapture] Too many arguments");a=b;c=d(a);if("undefined"===c||a===PS.DEFAULT)a=3;else{if("number"!==c)return h("[PS.imageCapture] format argument invalid");a=Math.floor(a);if(1>a&&4<a)return h("[PS.imageCapture] format argument is not 1, 2, 3 or 4")}f=r.x;l=r.y;c=d(e);if("undefined"===c||e===PS.DEFAULT)g=k=0,q=f,s=l;else if("object"===
c){g=e.left;c=d(g);if("undefined"===c||g===PS.DEFAULT)g=0;else{if("number"!==c)return h("[PS.imageCapture] region.left not a number");g=Math.floor(g);if(0>g)g=0;else if(g>=f)return h("[PS.imageCapture] region.left outside grid")}k=e.top;c=d(k);if("undefined"===c||k===PS.DEFAULT)k=0;else{if("number"!==c)return h("[PS.imageCapture] region.top not a number");k=Math.floor(k);if(0>k)k=0;else if(k>=l)return h("[PS.imageCapture] region.top outside grid")}q=e.width;c=d(q);if("undefined"===c||q===PS.DEFAULT)q=
f-g;else{if("number"!==c)return h("[PS.imageCapture] region.width not a number");q=Math.floor(q);if(1>q||g+q>f)q=f-g}s=e.height;c=d(s);if("undefined"===c||s===PS.DEFAULT)s=l-k;else{if("number"!==c)return h("[PS.imageCapture] region.height not a number");s=Math.floor(s);if(1>s||k+s>l)s=l-k}}else return h("[PS.imageCapture] region argument invalid");c="image_"+ma;ma+=1;l={source:PS.GRID,id:c,width:q,height:s,pixelSize:a,valid:!0,data:[]};m=q*s;if(1>m)return l;c=l.data;c.length=m*a;q=g+q;s=k+s;m=0;for(n=
k;n<s;n+=1)for(k=g;k<q;k+=1)t=k+n*f,t=A[t],t=t.color,3>a?(c[m]=t.rgb,2===a&&(c[m+1]=t.a)):(c[m]=t.r,c[m+1]=t.g,c[m+2]=t.b,4===a&&(c[m+3]=t.a)),m+=a;return l},imageDump:function(b,e,a,c,f){var l,k,q,s,m,n,t,p,r,L,u,z,w,I,H,x,B,y,A,U,K,F,J;l=arguments.length;if(1>l)return h("[PS.imageDump] Missing argument(s)");if(5<l)return h("[PS.imageDump] Too many arguments");l=a;k=c;if(Ya("[PS.imageDump] ",b)===PS.ERROR)return PS.ERROR;s=b.width;m=b.height;n=b.pixelSize;t=b.data;q=d(e);if("undefined"===q||e===
PS.DEFAULT)r=p=0,L=s,u=m;else if("object"===q){r=e.left;q=d(r);if("undefined"===q||r===PS.DEFAULT)r=0;else{if("number"!==q)return h("[PS.imageDump] region.left invalid");r=Math.floor(r);if(0>r)r=0;else if(r>=s)return h("[PS.imageDump] region.left outside grid")}p=e.top;q=d(p);if("undefined"===q||p===PS.DEFAULT)p=0;else{if("number"!==q)return h("[PS.imageDump] region.top invalid");p=Math.floor(p);if(0>p)p=0;else if(p>=m)return h("[PS.imageDump] region.top outside grid")}L=e.width;q=d(L);if("undefined"===
q||L===PS.DEFAULT)L=s-r;else{if("number"!==q)return h("[PS.imageDump] region.width invalid");L=Math.floor(L);if(1>L||r+L>s)L=s-r}u=e.height;q=d(u);if("undefined"===q||u===PS.DEFAULT)u=m-p;else{if("number"!==q)return h("[PS.imageDump] region.height invalid");u=Math.floor(u);if(1>u||p+u>m)u=m-p}}else return h("[PS.imageDump] region argument invalid");m=L*u;q=d(l);if("undefined"===q||l===PS.DEFAULT)l=n;else{if("number"!==q)return h("[PS.imageDump] format argument invalid");l=Math.floor(l);if(1>l||4<
l)return h("[PS.imageDump] format argument is not 1, 2, 3 or 4")}q=d(k);if("undefined"===q||k===PS.DEFAULT)k=L;else{if("number"!==q)return h("[PS.imageDump] length argument invalid");k=Math.floor(k);1>k&&(k=1);k>m&&(k=m)}q=g(f,PS.ERROR,!0,!0);if(q===PS.ERROR)return h("[PS.imageDump] hex argument invalid");z="\nvar myImage = {\n\twidth : "+L+", height : "+u+", pixelSize : "+l+",\n\tdata : [";if(1>m)return PS.debug(z+"]\n};\n"),PS.DONE;z+="\n\t";H=255;I=w=0;s*=n;p=p*s+r*n;for(x=0;x<u;x+=1){r=p;for(B=
0;B<L;B+=1){3>n?(K=t[r],1>K?y=A=U=0:16777215<=K?y=A=U=255:(y=K/M,y=Math.floor(y),F=y*M,A=(K-F)/N,A=Math.floor(A),J=A*N,U=K-F-J),2===n&&(H=t[r+1])):(y=t[r],A=t[r+1],U=t[r+2],K=y*M+A*N+U,4===n&&(H=t[r+3]));F=l;J=q;var C=H,G=void 0;3>F?(G="",G=J?G+Ja(K,6):G+K,2===F&&(G=J?G+(", "+Ja(C,2)):G+(", "+C))):(G=J?Ja(y,2)+", "+Ja(A,2)+", "+Ja(U,2):y+", "+A+", "+U,4===F&&(G=J?G+(", "+Ja(C,2)):G+(", "+C)));z+=G;I+=1;I<m&&(z+=",",w+=1,w<k?z+=" ":(w=0,z+="\n\t"));r+=n}p+=s}z+="\n\t]\n};\n";PS.debug(z);return PS.DONE},
spriteSolid:function(b,e){var a,c,f;a=arguments.length;if(2>a)return h("[PS.spriteSolid] Missing argument(s)");if(2<a)return h("[PS.spriteSolid] Too many argument(s)");a=b;c=e;if(a===PS.DEFAULT)a=1;else if("number"===d(a))a=Math.floor(a),1>a&&(a=1);else return h("[PS.spriteSolid] width argument invalid");if(c===PS.DEFAULT)c=1;else if("number"===d(c))c=Math.floor(c),1>c&&(c=1);else return h("[PS.spriteSolid] height argument invalid");f=Bb();f.width=a;f.height=c;f.color={rgb:0,r:0,g:0,b:0,a:255};return f.id},
spriteSolidColor:function(b,e,a,c){var f,d,k,q,g,s;f=arguments.length;if(1>f)return h("[PS.spriteSolidColor] Missing argument(s)");if(4<f)return h("[PS.spriteSolidColor] Too many argument(s)");f=Aa(b,"[PS.spriteSolidColor] ");if(f===PS.ERROR)return PS.ERROR;k=f.color;if(!k)return h("[PS.spriteSolidColor] Cannot set color of image sprite "+f.id);d=n("[PS.spriteSolidColor] ",e,a,c);if(d===PS.ERROR)return PS.ERROR;q=d.rgb;q!==PS.CURRENT&&(null===q?(q=d.r,q===PS.CURRENT?d.r=q=k.r:q===PS.DEFAULT&&(d.r=
q=0),g=d.g,g===PS.CURRENT?d.g=g=k.g:g===PS.DEFAULT&&(d.g=g=0),s=d.b,s===PS.CURRENT?d.b=s=k.b:s===PS.DEFAULT&&(d.b=s=0),d.rgb=q=q*M+g*N+s):q===PS.DEFAULT&&(d.rgb=q=0,d.r=0,d.g=0,d.b=0),k.rgb!==q&&(k.rgb=q,k.r=d.r,k.g=d.g,k.b=d.b,f.visible&&f.placed&&(Ka(f),Q())));return k.rgb},spriteSolidAlpha:function(b,e){var a,c,f,l;a=arguments.length;if(1>a)return h("[PS.spriteSolidAlpha] Missing argument(s)");if(2<a)return h("[PS.spriteSolidAlpha] Too many argument(s)");a=e;c=Aa(b,"[PS.spriteSolidAlpha] ");if(c===
PS.ERROR)return PS.ERROR;f=c.color;if(!f)return h("[PS.spriteSolidAlpha] Cannot set alpha of image sprite "+c.id);l=d(a);if("undefined"!==l&&a!==PS.CURRENT){if(a===PS.DEFAULT)a=255;else if("number"===l)a=Math.floor(a),0>a?a=0:255<a&&(a=255);else return h("[PS.spriteSolidAlpha] alpha argument invalid");f.a!==a&&(f.a=a,c.visible&&c.placed&&(Ka(c),Q()))}return f.a},spriteImage:function(b,e){var a,c,f,l,k,q,g,s,m,n,t,p,r,u,z,w,I;a=arguments.length;if(1>a)return h("[PS.spriteImage] Missing argument(s)");
if(2<a)return h("[PS.spriteImage] Too many argument(s)");if(Ya("[PS.spriteImage] ",b)===PS.ERROR)return PS.ERROR;s=g=0;a=c=b.width;m=f=b.height;l=b.pixelSize;k=b.data;q=d(e);if("undefined"!==q&&e!==PS.DEFAULT){if("object"!==q)return h("[PS.spriteImage] region argument invalid");s=e.left;q=d(s);if("undefined"===q||s===PS.DEFAULT)s=0;else{if("number"!==q)return h("[PS.spriteImage] region.left invalid");s=Math.floor(s);if(0>s)s=0;else if(s>=c)return h("[PS.spriteImage] region.left outside image")}g=
e.top;q=d(g);if("undefined"===q||g===PS.DEFAULT)g=0;else{if("number"!==q)return h("[PS.spriteImage] region.top invalid");g=Math.floor(g);if(0>g)g=0;else if(g>=f)return h("[PS.spriteImage] region.top outside image")}a=e.width;q=d(a);if("undefined"===q||a===PS.DEFAULT)a=c-s;else{if("number"!==q)return h("[PS.spriteImage] region.width invalid");a=Math.floor(a);if(1>a||s+a>c)a=c-s}m=e.height;q=d(m);if("undefined"===q||m===PS.DEFAULT)m=f-g;else{if("number"!==q)return h("[PS.spriteImage] region.height invalid");
m=Math.floor(m);if(1>m||g+m>f)m=f-g}}f=[];f.length=a*m*4;q=255;c*=l;g=g*c+s*l;for(t=p=0;t<m;t+=1){s=g;for(n=0;n<a;n+=1)3>l?(r=k[s],1>r?u=z=r=0:16777215<=r?u=z=r=255:(u=r/M,u=Math.floor(u),w=u*M,z=(r-w)/N,z=Math.floor(z),I=z*N,r=r-w-I),2===l&&(q=k[s+1])):(u=k[s],z=k[s+1],r=k[s+2],4===l&&(q=k[s+3])),f[p]=u,f[p+1]=z,f[p+2]=r,f[p+3]=q,s+=l,p+=4;g+=c}l=Bb();l.width=a;l.height=m;l.image={id:"image_"+ma,width:a,height:m,pixelSize:4,data:f};ma+=1;return l.id},spriteShow:function(b,e){var a,c;a=arguments.length;
if(1>a)return h("[PS.spriteShow] Missing argument(s)");if(2<a)return h("[PS.spriteShow] Too many argument(s)");c=Aa(b,"[PS.spriteShow] ");if(c===PS.ERROR)return PS.ERROR;a=g(e,PS.CURRENT,!0,PS.CURRENT);if(a===PS.ERROR)return h("[PS.spriteShow] show argument invalid");a!==PS.CURRENT&&c.visible!==a&&(c.visible=a,c.placed&&(a?(Ka(c),$a(c,b)):va(c),Q()));return c.visible},spriteAxis:function(b,e,a){var c,f,l,k;c=arguments.length;if(1>c)return h("[PS.spriteAxis] Missing argument(s)");if(3<c)return h("[PS.spriteAxis] Too many argument(s)");
c=e;f=a;l=Aa(b,"[PS.spriteAxis] ");if(l===PS.ERROR)return PS.ERROR;k=d(c);if("undefined"===k||c===PS.CURRENT)c=l.ax;else if(c===PS.DEFAULT)c=0;else if("number"===k)c=Math.floor(c);else return h("[PS.spriteAxis] x argument invalid");k=d(f);if("undefined"===k||f===PS.CURRENT)f=l.ay;else if(f===PS.DEFAULT)f=0;else if("number"===k)f=Math.floor(f);else return h("[PS.spriteAxis] y argument invalid");if(c!==l.ax||f!==l.ay)l.ax=c,l.ay=f,l.visible&&l.placed&&(Ka(l),$a(l,b),Q());return{x:l.ax,y:l.ay}},spritePlane:function(b,
e){var a,c,f;a=arguments.length;if(1>a)return h("[PS.spritePlane] Missing argument(s)");if(2<a)return h("[PS.spritePlane] Too many arguments");a=e;c=Aa(b,"[PS.spritePlane] ");if(c===PS.ERROR)return PS.ERROR;f=d(a);if("undefined"!==f&&a!==PS.CURRENT){if(a===PS.DEFAULT)a=0;else if("number"===f)a=Math.floor(a),1>a&&(a=0);else return h("[PS.spritePlane] plane argument invalid");c.plane!==a&&(c.visible&&c.placed&&va(c),c.plane=a,c.visible&&c.placed&&(Ka(c),Q()))}return 0>c.plane?0:c.plane},spriteMove:function(b,
e,a){var c,f,l,k,q,g,s,m,n,t,p,u;c=arguments.length;if(1>c)return h("[PS.spriteMove] Missing argument(s)");if(3<c)return h("[PS.spriteMove] Too many argument(s)");c=e;f=a;l=Aa(b,"[PS.spriteMove] ");if(l===PS.ERROR)return PS.ERROR;k=d(c);if("undefined"===k||c===PS.CURRENT)c=l.x;else if(c===PS.DEFAULT)c=0;else if("number"===k)c=Math.floor(c);else return h("[PS.spriteMove] x argument invalid");k=d(f);if("undefined"===k||f===PS.CURRENT)f=l.y;else if(f===PS.DEFAULT)f=0;else if("number"===k)f=Math.floor(f);
else return h("[PS.spriteMove] y argument invalid");l.placed&&c===l.x&&f===l.y||(u=!1,0>l.plane&&(l.plane=r.plane),l.visible&&l.placed&&(k=l.y,s=l.height,c>l.x?(g=c-l.x,q=l.x):l.x>c?(g=l.x-c,q=l.x+l.width-g):g=0,g>=l.width?(u=!0,va(l)):(m=l.x,t=l.width,f>l.y?(p=f-l.y,n=l.y):l.y>f?(p=l.y-f,n=l.y+l.height-p):p=0,p>=l.height?(u=!0,va(l)):1>p?(u=!0,va(l,q,k,g,s)):(1>t?u=!0:(u=!0,t-=g,c>l.x&&(m+=g),va(l,q,k,g,s)),va(l,m,n,t,p)))),l.x=c,l.y=f,l.placed=!0,l.visible&&(u=!0,Ka(l),$a(l,b)),u&&Q());return{x:l.x,
y:l.y}},spriteCollide:function(b,e){var a,c,f;a=arguments.length;if(1>a)return h("[PS.spriteCollide] Missing argument(s)");if(2<a)return h("[PS.spriteCollide] Too many arguments");a=Aa(b,"[PS.spriteCollide] ");if(a===PS.ERROR)return PS.ERROR;c=e;f=d(c);if("undefined"!==f&&c!==PS.CURRENT){if(c===PS.DEFAULT)c=null;else if("function"!==f)return h("[PS.spriteCollide] exec argument not a function");a.collide!==c&&(a.collide=c)&&a.visible&&a.placed&&$a(a,b)}return a.collide},spriteDelete:function(b){var e,
a,c;e=arguments.length;if(1>e)return h("[PS.spriteDelete] Missing argument");if(1<e)return h("[PS.spriteDelete] Too many arguments");if("string"!==typeof b||1>b.length)return h("[PS.spriteDelete] sprite argument invalid");e=qa.length;for(a=0;a<e;a+=1)if(c=qa[a],c.id===b)return va(c),qa.splice(a,1),Q(),PS.DONE;return h("[PS.spriteDelete] sprite id '"+b+"' not found")},audioLoad:function(b,e){var a;if(1>arguments.length)return h("[PS.audioLoad] Missing argument(s)");if(2<arguments.length)return h("[PS.audioLoad] Too many arguments");
a=AQ.load(b,e);return a===AQ.ERROR?PS.ERROR:a.channel},audioPlay:function(b,e){var a,c;a=arguments.length;if(1>a)return h("[PS.audioPlay] Missing argument(s)");if(2<a)return h("[PS.audioPlay] Too many arguments");a=e;c=d(a);if("undefined"===c)a={};else if("object"!==c)return h("[PS.audioPlay] params argument invalid");a.autoplay=!0;a=AQ.load(b,a);return a===AQ.ERROR?PS.ERROR:a.channel},audioPause:function(b){var e;e=arguments.length;if(1>e)return h("[PS.audioPause] Missing argument(s)");if(1<e)return h("[PS.audioPause] Too many arguments");
e=AQ.pause(b);return e===AQ.ERROR?PS.ERROR:e},audioStop:function(b){var e;e=arguments.length;if(1>e)return h("[PS.audioStop] Missing argument(s)");if(1<e)return h("[PS.audioStop] Too many arguments");e=AQ.stop(b);return e===AQ.ERROR?PS.ERROR:e===AQ.DONE?PS.DONE:e},piano:function(b,e){var a,c,f;a=Eb.length;f=b;c=d(f);if("number"!==c)return h("[PS.piano] index argument invalid");f=Math.floor(f);1>f?f=1:f>a&&(f=a);a=e;if(!0!==a&&!1!==a)if(c=d(a),"undefined"===c)a=!1;else if("number"!==c)return h("[PS.piano] flag argument invalid");
c="piano_"+Eb[f-1];a&&(c="l_"+c);return c},harpsichord:function(b,e){var a,c,f;a=Fb.length;f=b;c=d(f);if("number"!==c)return h("[PS.harpsichord] index argument invalid");f=Math.floor(f);1>f?f=1:f>a&&(f=a);a=e;if(!0!==a&&!1!==a)if(c=d(a),"undefined"===c)a=!1;else if("number"!==c)return h("[PS.harpsichord] flag argument invalid");c="hchord_"+Fb[f-1];a&&(c="l_"+c);return c},xylophone:function(b){var e;e=Gb.length;if("number"!==d(b))return h("[PS.xylophone] index argument invalid");b=Math.floor(b);1>
b?b=1:b>e&&(b=e);return"xylo_"+Gb[b-1]},debug:function(b){var e,a;if(1<arguments.length)return h("[PS.debug] Too many arguments");e=b;a=d(e);"undefined"===a?e="":"string"!==a&&(e=e.toString());bb||(a=document.getElementById("debug"),a.style.display="inline",a=document.getElementById("monitor"),a.value="",bb=!0,Ia=!1);0<e.length&&(a=document.getElementById("monitor"),a.value+=e,a.scrollTop=a.scrollHeight);e=document.getElementById(jb);e.scrollTop=e.scrollHeight;return PS.DONE},debugClose:function(){if(0<
arguments.length)return h("[PS.debugClose] Too many arguments");document.getElementById("debug").style.display="none";bb=!1;return PS.DONE},debugClear:function(){if(0<arguments.length)return h("[PS.debugClear] Too many arguments");document.getElementById("monitor").value="";return PS.DONE},line:function(b,e,a,c){var f,l,k,q;f=arguments.length;if(4>f)return h("[PS.line] Missing argument(s)");if(4<f)return h("[PS.line] Too many arguments");f=b;l=e;k=a;q=c;if("number"===d(f))f=Math.floor(f);else return h("[PS.line] x1 argument not a number");
if("number"===d(l))l=Math.floor(l);else return h("[PS.line] y1 argument not a number");if("number"===d(k))k=Math.floor(k);else return h("[PS.line] x2 argument not a number");if("number"===d(q))q=Math.floor(q);else return h("[PS.line] y2 argument not a number");var g,s,m,n,t,p,r;g=k>f?k-f:f-k;s=q>l?q-l:l-q;m=f<k?1:-1;n=l<q?1:-1;t=g-s;for(r=[];f!==k||l!==q;){p=2*t;p>-s&&(t-=s,f+=m);if(f===k&&l===q){r.push([f,l]);break}p<g&&(t+=g,l+=n);r.push([f,l])}return r},pathMap:function(b){var e;e=arguments.length;
if(1>e)return h("[PS.pathMap] Missing argument(s)");if(1<e)return h("[PS.pathMap] Too many arguments");if(Ya("[PS.pathMap] ",b)===PS.ERROR)return PS.ERROR;if(1!==b.pixelSize)return h("[PS.pathMap] image is not format 1");e=b.width;var a=b.height,c=b.data,d,l,k,q,g;l=c.length;d=[];d.length=l;for(q=l=0;q<a;q+=1)for(k=0;k<e;k+=1)g=c[l],g={x:k,y:q,value:g,ovalue:g,f:0,g:0,h:0,cost:0,parent:null,closed:!1,visited:!1},d[l]=g,l+=1;e={id:"pathmap_"+cb,width:e,height:a,nodes:d};cb+=1;Ba.push(e);return e.id},
pathFind:function(b,e,a,c,f,l){var k,q,g,s,m,t,n,p;k=arguments.length;if(5>k)return h("[PS.pathFind] Missing argument(s)");if(6<k)return h("[PS.pathFind] Too many arguments");q=e;g=a;k=c;s=f;if("string"!==typeof b||1>b.length)return h("[PS.pathFind] pathmap argument invalid");m=kb(b);if(!m)return h("[PS.pathFind] "+b+" not found");if("number"===d(q)){if(q=Math.floor(q),0>q||q>=m.width)return h("[PS.pathFind] x1 argument is outside "+b)}else return h("[PS.pathFind] x1 argument not a number");if("number"===
d(g)){if(g=Math.floor(g),0>g||g>=m.height)return h("[PS.pathFind] y1 argument is outside "+b)}else return h("[PS.pathFind] y1 argument not a number");if("number"===d(k)){if(k=Math.floor(k),0>k||k>=m.width)return h("[PS.pathFind] x2 argument is outside "+b)}else return h("[PS.pathFind] x2 argument not a number");if("number"===d(s)){if(s=Math.floor(s),0>s||s>=m.height)return h("[PS.pathFind] y2 argument is outside "+b)}else return h("[PS.pathFind] y2 argument not a number");n=p=!1;t=d(l);if("undefined"!==
t&&l!==PS.DEFAULT){if("object"!==t)return h("[PS.pathFind] options argument invalid");n=l.no_diagonals;if(!0===n||!1===n)p=n;else if(t=d(n),"undefined"===t||n===PS.DEFAULT)p=!1;else if("number"===t)p=n?!1:!0;else return h("[PS.pathFind] options.no_diagonals invalid");n=l.cut_corners;if(!0!==n&&!1!==n)if(t=d(n),"undefined"===t||n===PS.DEFAULT)n=!1;else if("number"===t)n=n?!1:!0;else return h("[PS.pathFind] options.cut_corners invalid")}a:{var r=q,u=g,z,w,I,H,x,y;if(r===k&&u===s)k=[];else if(g=m.width,
q=m.height,m=m.nodes,z=m[u*g+r],z.value)if(z=m[s*g+k],z.value){if(!p){b:{t=r;w=u;var A,B;I=k>t?k-t:t-k;z=s>w?s-w:w-s;H=t<k?1:-1;x=w<s?1:-1;y=I-z;for(B=[];t!==k||w!==s;){A=2*y;A>-z&&(y-=z,t+=H);if(t===k&&w===s){B.push([t,w]);break}A<I&&(y+=I,w+=x);A=w*g+t;A=m[A];if(!A.value){t=null;break b}B.push([t,w])}t=B}if(t){k=t;break a}}t=m.length;for(I=0;I<t;I+=1)z=m[I],z.f=0,z.g=0,z.h=0,z.cost=0,z.closed=!1,z.visited=!1,z.parent=null;t=[];w=new Cb(lc);z=m[u*g+r];for(w.push(z);0<w.size();){r=w.pop();if(r.x===
k&&r.y===s){for(k=r;k.parent;)t.push([k.x,k.y]),k=k.parent;t.reverse();break}r.closed=!0;u=m;I=p;z=n;var U=A=B=y=x=H=void 0,K=void 0,F=void 0,G=void 0,C=void 0,J=C=void 0,M=void 0,N=void 0,O=void 0;H=[];x=r.x;y=r.y;B=g-1;A=q-1;F=y*g;U=(y-1)*g;K=(y+1)*g;O=N=M=J=!1;0<x&&((G=x-1,C=F+G,C=u[C],C.value)?C.closed||(C.cost=C.value,H.push(C)):O=!0);x<B&&((G=x+1,C=F+G,C=u[C],C.value)?C.closed||(C.cost=C.value,H.push(C)):N=!0);0<y&&((C=U+x,C=u[C],C.value)?C.closed||(C.cost=C.value,H.push(C)):J=!0);y<A&&((C=
K+x,C=u[C],C.value)?C.closed||(C.cost=C.value,H.push(C)):M=!0);I||(0<x&&(G=x-1,0<y&&(z||!O&&!J)&&(C=U+G,C=u[C],C.value&&!C.closed&&(C.cost=C.value*La,H.push(C))),y<A&&(z||!O&&!M)&&(C=K+G,C=u[C],C.value&&!C.closed&&(C.cost=C.value*La,H.push(C)))),x<B&&(G=x+1,0<y&&(z||!J&&!N)&&(C=U+G,C=u[C],C.value&&!C.closed&&(C.cost=C.value*La,H.push(C))),y<A&&(z||!M&&!N)&&(C=K+G,C=u[C],C.value&&!C.closed&&(C.cost=C.value*La,H.push(C)))));u=H;z=u.length;for(I=0;I<z;I+=1)if(H=u[I],x=r.g+H.cost,y=H.visited,!y||x<H.g)H.visited=
!0,H.parent=r,H.h=H.h||Db(H.x,H.y,k,s),H.g=x,H.f=H.g+H.h,y?w.rescore(H):w.push(H)}k=t}else k=[];else k=[]}return k},pathData:function(b,e,a,c,f,k){var q,g,s,m,t,n,p;q=arguments.length;if(5>q)return h("[PS.pathData] Missing argument(s)");if(6<q)return h("[PS.pathData] Too many arguments");g=e;s=a;m=c;t=f;n=k;if("string"!==typeof b||1>b.length)return h("[PS.pathData] pathmap argument invalid");q=kb(b);if(!q)return h("[PS.pathData] "+b+" not found");if("number"===d(g)){if(g=Math.floor(g),0>g||g>=q.width)return h("[PS.pathData] left argument is outside "+
b)}else return h("[PS.pathData] left argument not a number");if("number"===d(s)){if(s=Math.floor(s),0>s||s>=q.height)return h("[PS.pathData] top argument is outside "+b)}else return h("[PS.pathData] top argument not a number");if(m===PS.DEFAULT)m=1;else if("number"===d(m))m=Math.floor(m),1>m?m=1:(p=q.width-g,m>p&&(m=p));else return h("[PS.pathData] width argument not a number");if(t===PS.DEFAULT)t=1;else if("number"===d(t))t=Math.floor(t),1>t?t=1:(p=q.height-s,t>p&&(t=p));else return h("[PS.pathData] height argument not a number");
if(n!==PS.DEFAULT&&n!==PS.CURRENT)if(p=d(n),"undefined"===p)n=PS.CURRENT;else if("number"===p){if(0>n)return h("[PS.pathData] data argument < 0")}else return h("[PS.pathData] data argument not a number");p=s;var r=t,u,w,z,y;t=[];t.length=m*r;s=q.nodes;r=p+r;z=0;for(w=p;w<r;w+=1)for(p=w*q.width+g,u=0;u<m;u+=1)y=s[p],n!==PS.CURRENT&&(y.value=n===PS.DEFAULT?y.ovalue:n),t[z]=y.value,z+=1,p+=1;return t},pathDelete:function(b){if(1>arguments.length)return h("[PS.pathDelete] Missing argument");if("string"!==
typeof b||1>b.length)return h("[PS.pathDelete] pathmap argument invalid");var e;a:{var a,c,d,k;e=Ba.length;for(a=0;a<e;a+=1)if(c=Ba[a],c.id===b){d=c.nodes;e=d.length;for(k=0;k<e;k+=1)d[k]=null;c.nodes=null;Ba.splice(a,1);e=!0;break a}e=!1}return e?PS.DONE:h("[PS.pathDelete] "+b+" not found")},pathNear:function(b,e,a,c,d){var k,q;k=arguments.length;if(5>k)return h("[PS.pathNear] Missing argument(s)");if(5<k)return h("[PS.pathNear] Too many arguments");if("string"!==typeof b||1>b.length)return h("[PS.pathNear] pathmap argument invalid");
k=kb(b);if(!k)return h("[PS.pathNear] "+b+" not found");a:{var g,s,m,t,n,p,r,u,w,z,y,x,A;g=k.nodes;s=k.width;m=k.height;for(t=1;t<s;){k=[];n=c-t;r=c+t;p=d-t;u=d+t;w=n;0>w&&(w=0);z=r+1;z>=s&&(z=s);if(0<=p)for(y=p*s+w,x=w;x<z;x+=1)A=g[y],A.value&&k.push([A.x,A.y]),y+=1;if(u<m)for(y=u*s+w,x=w;x<z;x+=1)A=g[y],A.value&&k.push([A.x,A.y]),y+=1;w=p+1;0>w&&(w=0);z=u;z>=m&&(z=m);if(0<=n)for(y=w*s+n,x=w;x<z;x+=1)A=g[y],A.value&&k.push([A.x,A.y]),y+=s;if(r<s)for(y=w*s+r,x=w;x<z;x+=1)A=g[y],A.value&&k.push([A.x,
A.y]),y+=s;if(n=k.length){if(1===n){q=k[0];break a}g=s+m;for(x=0;x<n;x+=1)s=k[x],s=Db(e,a,s[0],s[1]),s<g&&(g=s,q=x);q=k[q];break a}t+=1}q=[e,a]}return q}}})();
(function(){var d,g,m,p;d=0;g=["webkit","moz","ms","o"];for(m=0;m<g.length&&!window.requestAnimationFrame;m+=1)p=g[m],window.requestAnimationFrame=window[p+"RequestAnimationFrame"],window.cancelAnimationFrame=window[p+"CancelAnimationFrame"]||window[p+"CancelRequestAnimationFrame"];window.requestAnimationFrame||(window.requestAnimationFrame=function(g,m){var p,S,w;p=(new Date).getTime();S=Math.max(0,16-(p-d));w=window.setTimeout(function(){g(p+S)},S);d=p+S;return w});window.cancelAnimationFrame||
(window.cancelAnimationFrame=function(d){window.clearTimeout(d)})})();var AQ;
(function(){function d(d){var k;k=typeof d;"number"===k?isNaN(d)&&(k="NaN"):"object"===k&&(d?d instanceof Array&&(k="array"):k="null");return k}function g(d){d.stopPropagation?d.stopPropagation():d.cancelBubble=!0;d.preventDefault();return!1}function m(d,k){var h;if("string"!==typeof d||1>d.length)d="???";d="AQ ERROR: "+d+"\n";if(Ma&&k){h=d;var g;g=k.stack;var m,p,w;console&&console.log&&console.log(g);if(g.split){g=g.split("\n");p="";w=g.length;for(m=0;m<w;m+=1){var x=g[m],y=void 0,B=void 0,B=void 0,
y="";-1!==x.search(".js")&&(B=x.lastIndexOf("/")+1,B=x.substr(B).replace(/^[\s\(\)]+|[\s\(\)]+$/g,""),3===B.split(":").length&&(B=B.substr(0,B.lastIndexOf(":"))),""!==B&&(y+="    "+B+"\n"));p+=y}g=p}d=h+(g+"\n")}if((h=sa)&&"function"===typeof h)try{h(d)}catch(F){window.alert(d+" ["+k.message+"]\n")}return AQ.ERROR}function p(d){try{throw Error("AQ ERROR");}catch(k){return m(d,k)}}function B(h,k){var g,m,n,x,y;g=d(k);if("undefined"===g||null===k||k===AQ.DEFAULT)return w.filetypes;if("array"!==g)return p(h+
".fileTypes not an array");g=k.length;if(1>g)return p(h+".fileTypes array empty");n=[];for(m=0;m<g;m+=1){x=k[m];if(!x||"string"!==typeof x||1>x.length)return p(h+"Invalid .fileType entry @ "+m);x=x.toLowerCase();(y=F[x])&&y.ok&&0>n.indexOf(x)&&n.push(x)}return 1>n.length?p(h+"No playable audio types listed"):n}function y(h,k,g){var m,n;m=d(g);if(!g||"undefined"===m)return AQ.DONE;if("object"!==m)return p(h+"params not an object");n=g.path;m=d(n);if("undefined"!==m){if(n===AQ.DEFAULT)n=w.path;else if("string"!==
m||1>n.length)return p(h+".path property not a valid string");k.path=n}n=B(h,g.fileTypes);if(n===AQ.ERROR)return AQ.ERROR;n&&(k.fileTypes=n);n=g.autoplay;m=d(n);if("undefined"!==m){if(!0!==n&&!1!==n)if(n===AQ.DEFAULT)n=w.autoplay;else if(null===n)n=!1;else if("number"===m)n=0!==n;else return p(h+".autoplay property invalid");k.autoplay=n}n=g.lock;m=d(n);if("undefined"!==m){if(!0!==n&&!1!==n)if(n===AQ.DEFAULT)n=w.lock;else if(null===n)n=!1;else if("number"===m)n=0!==n;else return p(h+".lock property invalid");
k.lock=n}n=g.volume;m=d(n);if("undefined"!==m){if(n===AQ.DEFAULT)n=w.volume;else{if("number"!==m)return p(h+".volume property not a number");n>S?n=S:0>n&&(n=0)}k.volume=n}n=g.loop;m=d(n);if("undefined"!==m){if(!0!==n&&!1!==n)if(n===AQ.DEFAULT)n=w.loop;else if(null===n)n=!1;else if("number"===m)n=0!==n;else return p(h+".loop property invalid");k.loop=n}n=g.start;m=d(n);if("undefined"!==m){if(n===AQ.DEFAULT)n=w.start;else{if("number"!==m)return p(h+".start property not a number");n=Math.floor(n);0>
n&&(n=0)}k.start=n}n=g.end;m=d(n);if("undefined"!==m){if(n===AQ.DEFAULT)n=w.end;else{if("number"!==m)return p(h+".end property not a number");n=Math.floor(n);0>n&&(n=0)}k.end=n}n=g.onLoad;m=d(n);if("undefined"!==m){if(n===AQ.DEFAULT)n=w.onLoad;else if("function"!==m)return p(h+".onLoad property not a function");k.onLoad=n}n=g.onPlay;m=d(n);if("undefined"!==m){if(n===AQ.DEFAULT)n=w.onPlay;else if("function"!==m)return p(h+".onPlay property not a function");k.onPlay=n}n=g.onEnd;m=d(n);if("undefined"!==
m){if(n===AQ.DEFAULT)n=w.onEnd;else if("function"!==m)return p(h+".onEnd property not a function");k.onEnd=n}n=g.data;m=d(n);"undefined"!==m&&(n===AQ.DEFAULT&&(n=w.data),k.data=n);return AQ.DONE}function O(d){return{name:d,path:ra,fileTypes:ca,lock:w.loop,volume:w.volume,start:w.start,end:w.end,loop:w.loop,autoplay:w.autoplay,onLoad:w.onLoad,onPlay:w.onPlay,onEnd:w.onEnd,data:w.data}}var S=1,w={path:"",filetypes:["ogg","mp3","wav"],autoplay:!1,volume:0.5,start:0,end:-1,loop:!1,lock:!1,onLoad:null,
onPlay:null,onEnd:null,data:0},$=!1,ra="",sa=null,Ma=!1,V=!1,Q=!1,ca=null,F={ogg:{ok:!1,type:'audio/ogg; codecs="vorbis"'},mp3:{ok:!1,type:"audio/mpeg;"},wav:{ok:!1,type:'audio/wav; codecs="1"'},aac:{ok:!1,type:'audio/mp4; codecs="mp4a.40.2"'},webm:{ok:!1,type:'audio/webm; codecs="vorbis"'},opus:{ok:!1,type:'audio/ogg; codecs="opus"'}},h=[],aa=0,la=0,ia=null,x={context:null,buffers:[],bufferID:0,stopChannel:function(d){var k;(k=d.source)&&3!==k.playbackState&&(d.thandle&&window.clearTimeout(d.thandle),
void 0!==k.stop?k.stop(0):k.noteOff(0),d.status="READY");return AQ.DONE},assignChannel:function(){la+=1;return"ch_"+la},playBuffer:function(d,k){var g,t,n,w,y,B,F,K,O;g=x.context;t=g.createBufferSource();if(!t)return p("[AQ._web.playBuffer] Invalid bufferSource");t.buffer=d.audio;n=void 0!==g.createGain?g.createGain():g.createGainNode();if(!n)return p("[AQ._web.playBuffer] Invalid gainNode");t.connect(n);n.connect(g.destination);n.gain.value=d.params.volume;void 0===k&&(k=0);w=d.audio.duration-k;
y=Math.floor(1E3*w);d.channel_id||(d.channel_id=x.assignChannel());B=d.channel_id;F={id:B,buffer:d,source:t,gainNode:n,startTime:g.currentTime-k,pauseTime:0,endTime:-1,status:"PLAYING"};F.thandle=window.setTimeout(function(){var d,k;d=h.length;for(k=0;k<d;k+=1)if(F=h[k],F.id===B){d=F.buffer;K=d.params;if((O=K.onEnd)&&"function"===typeof O)try{O({channel:d.channel_id,name:K.name,path:K.pathname,duration:d.duration,data:K.data})}catch(g){m("[AQ._web.playBuffer] User .onEnd failed on "+B+": "+K.pathname+
" ["+g.message+"]",g)}x.stopChannel(F);h.splice(k,1);K.loop&&x.playBuffer(d,0);return}p("[AQ._web.playBuffer] Channel "+B+" not found")},y);h.push(F);void 0!==t.start?t.start(0,k,w):t.noteGrainOn(0,k,w);K=d.params;if((O=K.onPlay)&&"function"===typeof O)try{O({channel:d.channel_id,name:K.name,path:K.pathname,duration:d.duration,data:K.data})}catch(Q){m("[AQ._web.playBuffer] User .onPlay failed on "+d.channel_id+": "+K.pathname+" ["+Q.message+"]",Q)}return B},load:function(d){var k,h,g,n;k=x.buffers.length;
for(h=0;h<k;h+=1)if(g=x.buffers[h],g.params.pathname===d.pathname)return g.channel_id;x.bufferID+=1;g={id:"bf_"+x.bufferID,channel_id:x.assignChannel(),audio:null,duration:0,params:d};n=new XMLHttpRequest;if(!n)return p("[AQ._web.load] XMLHttpRequest error");n.open("GET",d.pathname,!0);n.responseType="arraybuffer";n.onload=function(){x.context.decodeAudioData(n.response,function(k){g.audio=k;g.duration=Math.floor(1E3*k.duration);x.buffers.push(g);if((k=d.onLoad)&&"function"===typeof k){d.onLoad=null;
try{k({channel:g.channel_id,name:d.name,path:d.pathname,duration:g.duration,data:d.data})}catch(h){m("[AQ._web.load] User .onLoad failed on "+g.channel_id+": "+d.pathname+" ["+h.message+"]",h)}}g.params.autoplay&&x.playBuffer(g)},function(){p("[AQ._web.load] Error loading "+d.pathname)})};try{n.send()}catch(w){return m("[AQ._web.load] XMLHttpRequest failed: "+d.pathname+" ["+w.message+"]",w)}return g.channel_id},play:function(d){var k,h,g;k=x.buffers.length;for(h=0;h<k;h+=1)if(g=x.buffers[h],g.params.pathname===
d.pathname)return x.playBuffer(g);d.autoplay=!0;return x.load(d)},playChannel:function(d){var k,h,g;k=x.buffers.length;for(h=0;h<k;h+=1)if(g=x.buffers[h],g.channel_id===d)return x.playBuffer(g);return p("[AQ._web.playChannel] "+d+" not found")},pause:function(d){var k,g,m,n,p;k=h.length;for(g=0;g<k;g+=1)if(m=h[g],m.id===d){k=m.buffer;n=m.source;p=m.pauseTime;if(0<p&&"PAUSED"===m.status)return h.splice(g,1),x.playBuffer(k,p);m.thandle&&(window.clearTimeout(m.thandle),m.thandle=null);n&&3!==n.playbackState?
(p=x.context.currentTime-m.startTime,p%=k.audio.duration,m.pauseTime=p,m.status="PAUSED",void 0!==n.stop?n.stop(0):n.noteOff(0)):h.splice(g,1);return d}return AQ.ERROR},stop:function(d){var k,g,m;k=h.length;for(g=0;g<k;g+=1)if(m=h[g],m.id===d)return x.stopChannel(m),h.splice(g,1),AQ.DONE;return AQ.ERROR},init:function(){x.buffers=[];x.bufferID=0;return AQ.WEB_AUDIO}},R={onError:function(d){var k,m;k=d.currentTarget.getAttribute("data-channel");k=parseInt(k,10);k=h[k];switch(d.target.error.code){case 1:m=
"Playback aborted";break;case 2:m="Network failure";break;case 3:m="Source decode failed";break;case 4:m="Invalid source file";break;default:m="Unknown"}p("[AQ._html.onError] "+m+" @ "+k.id+": "+k.params.pathname);return g(d)},onStalled:function(d){return g(d)},startChannel:function(h,k){var g,m,n;h.status="PLAYING";g=h.audio;n=d(k);"object"===n&&(m=k.volume,n=d(m),"undefined"!==n&&(h.params.volume=m,g.volume=m),m=k.loop,n=d(m),"undefined"!==n&&(h.params.loop=m,g.loop=m),m=k.onDone,n=d(m),"undefined"!==
n&&(h.params.onDone=m),m=k.userData,n=d(m),"undefined"!==n&&(h.params.userData=m),m=k.lock,n=d(m),"undefined"!==n&&(h.params.lock=m));g.play()},onLoad:function(d){var k,q,p;k=d.currentTarget.getAttribute("data-channel");k=parseInt(k,10);k=h[k];k.status="READY";q=k.params;k.audio.removeEventListener("canplaythrough",R.onLoad,!1);if((p=q.onLoad)&&"function"===typeof p){q.onLoad=null;try{p({channel:k.id,name:q.name,path:q.pathname,duration:k.duration,data:q.data})}catch(n){return m("[AQ._html.onLoad] User .onLoad failed on "+
k.id+": "+q.pathname+" ["+n.message+"]",n),g(d)}}q.autoplay&&(q.autoplay=!1,R.startChannel(k,q));return g(d)},onPlay:function(d){var k,q,p;k=d.currentTarget.getAttribute("data-channel");k=parseInt(k,10);k=h[k];q=k.params;if((p=q.onPlay)&&"function"===typeof p)try{p({channel:k.id,name:q.name,path:q.pathname,duration:k.duration,data:q.data})}catch(n){m("[AQ._html.onPlay] User .onPlay failed on "+k.id+": "+q.pathname+" ["+n.message+"]",n)}return g(d)},onEnd:function(d){var k,q,p;k=d.currentTarget.getAttribute("data-channel");
k=parseInt(k,10);k=h[k];q=k.params;k.status="READY";if((p=q.onEnd)&&"function"===typeof p)try{p({channel:k.id,name:q.name,path:q.pathname,duration:k.duration,data:q.data})}catch(n){m("[AQ._html.onEnd] User .onEnd failed on "+k.id+": "+q.pathname+" ["+n.message+"]",n)}return g(d)},loadChannel:function(d,k){var h;d.params=k;d.status="LOADING";h=d.audio;d.duration=Math.floor(1E3*h.duration);h.addEventListener("canplaythrough",R.onLoad,!1);h.preload="auto";h.volume=k.volume;h.loop=k.loop;h.setAttribute("src",
k.pathname)},load:function(d){var k,g;for(k=0;k<aa;k+=1)if(g=h[k],g.params.pathname===d.pathname&&"READY"===g.status)return g.audio.currentTime=0,d.autoplay&&R.startChannel(g,d),g.id;for(k=0;32>k;k+=1)if(g=h[k],"EMPTY"===g.status)return k+=1,k>aa&&(aa=k),R.loadChannel(g,d),g.id;for(k=0;k<aa;k+=1)if(g=h[k],!g.params.lock&&"READY"===g.status)return g.audio.currentTime=0,R.loadChannel(g,d),g.id;return AQ.ERROR},play:function(d){var k,g;for(k=0;k<aa;k+=1)if(g=h[k],g.params.pathname===d.pathname&&"READY"===
g.status)return g.audio.currentTime=0,R.startChannel(g,d),g.id;d.autoplay=!0;return R.load(d)},playChannel:function(d){var k,g;for(k=0;k<aa;k+=1)if(g=h[k],g.id===d){if("READY"!==g.status)return p("[AQ._html.playChannel] "+d+" not ready");g.audio.currentTime=0;R.startChannel(g);return g.id}return p("[AQ._html.playChannel] "+d+" not found")},pause:function(d){var k,g;for(k=0;k<aa;k+=1)if(g=h[k],g.id===d)return"PAUSED"===g.status?R.startChannel(g):"PLAYING"===g.status&&(g.status="PAUSED",g.audio.pause()),
d;return AQ.ERROR},stop:function(d){var g,m;for(g=0;g<aa;g+=1)if(m=h[g],m.id===d){m.params.autoplay=!1;d=m.status;if("PLAYING"===d||"PAUSED"===d)m.status="READY",m.audio.pause(),m.audio.currentTime=0;return AQ.DONE}return AQ.ERROR},init:function(){var d,g;h.length=32;for(d=0;32>d;d+=1){g=document.createElement("audio");if(!g)return p("[AQ._html.init] element init failed");g.setAttribute("data-channel",d.toString());g.addEventListener("error",R.onError,!1);g.addEventListener("stalled",R.onStalled,
!1);g.addEventListener("play",R.onPlay,!1);g.addEventListener("ended",R.onEnd,!1);document.body.appendChild(g);h[d]={id:"ch_"+(d+1),audio:g,duration:0,params:null,status:"EMPTY"}}return AQ.HTML5_AUDIO}};AQ={ERROR:"AQ.ERROR",DONE:"AQ.DONE",DEFAULT:"AQ.DEFAULT",HTML5_AUDIO:"AQ.HTML5_AUDIO",WEB_AUDIO:"AQ.WEB_AUDIO",init:function(g){var k,m,t,n;$=!1;ra=w.path;ca=w.filetypes;sa=null;Q=Ma=!1;k=document.createElement("audio");if(!k.canPlayType)return window.alert("[AQ.init] Audio codec testing not available\n"),
AQ.ERROR;for(m in F)F.hasOwnProperty(m)&&(t=F[m],n=k.canPlayType(t.type),"probably"===n&&(t.ok=!0));if(g){if("object"!==typeof g)return window.alert("[AQ.init] Invalid parameter\n"),AQ.ERROR;k=g.onAlert;m=d(k);if("undefined"!==m){if(null===k||k===AQ.DEFAULT)k=null;else if("function"!==m)return window.alert("[AQ.init] .onAlert property not a function"),AQ.ERROR;sa=k}k=g.stack;m=d(k);if("undefined"!==m){if(k&&k!==AQ.DEFAULT)if(!0===k||"number"!==m)k=!0;else return window.alert("[AQ.init] .stack property not a boolean"),
AQ.ERROR;else k=!1;Ma=k}k=g.forceHTML5;m=d(k);if("undefined"!==m){if(!0!==k&&!1!==k)if(k===AQ.DEFAULT)k=!1;else if("number"===m)k=0!==k;else return p("[AQ.init] .forceHTML5 property invalid");Q=k}k=g.defaultPath;m=d(k);if("undefined"!==m){if(null===k||k===AQ.DEFAULT)k=w.path;else if("string"!==m)return p("[AQ.init] .defaultPath property not a valid string");ra=k}k=B("[AQ.init] ",g.defaultFileTypes);if(k===AQ.ERROR)return AQ.ERROR;k&&(ca=k)}la=aa=h.length=0;x.context=null;V=!1;if(!Q&&(g=window.AudioContext||
window.webkitAudioContext||window.mozAudioContext||window.oAudioContext||window.msAudioContext)){x.context=new g;if(!x.context)return p("[AQ.init] AudioContext init failed");V=!0}if(V)ia=x;else{if(!document.createElement("audio").canPlayType)return p("[AQ.init] HTML5 Audio not supported");ia=R}g=ia.init();g!==AQ.ERROR&&($=!0);return{name:"AQ",major:1,minor:0,revision:3,status:g}},load:function(d,g){var h;if(!$)return AQ.ERROR;if(!d||"string"!==typeof d||1>d.length)return p("[AQ.load] name parameter invalid");
h=O(d);if(y("[AQ.load] ",h,g)===AQ.ERROR)return AQ.ERROR;h.pathname=h.path+h.name+"."+h.fileTypes[0];return ia.load(h)},play:function(d,g){var h;if(!$)return AQ.ERROR;if(!d||"string"!==typeof d||1>d.length)return p("[AQ.play] name parameter invalid");h=O(d);if(y("[AQ.play] ",h,g)===AQ.ERROR)return AQ.ERROR;h.pathname=h.path+h.name+"."+h.fileTypes[0];return ia.play(h)},playChannel:function(d){return $?!d||"string"!==typeof d||1>d.length?p("[AQ.playChannel] Invalid channel id"):ia.playChannel(d):AQ.ERROR},
pause:function(d){return $?!d||"string"!==typeof d||1>d.length?p("[AQ.pause] Invalid channel id"):ia.pause(d):AQ.ERROR},stop:function(d){return $?!d||"string"!==typeof d||1>d.length?p("[AQ.stop] Invalid channel id"):ia.stop(d):AQ.ERROR}}})();function clone(d){function g(){}g.prototype=d;return new g}function randBetween(d,g){range=g-d+1;return Math.floor(Math.random()*range)+d}PS.style=function(d,g,m){if("object"!==typeof m)throw Error("Style was invalid: "+m);ApplyStyle(d,g,m)};
function ApplyStyle(d,g,m){"undefined"!==typeof m.color&&PS.color(d,g,m.color);"undefined"!==typeof m.alpha&&PS.alpha(d,g,m.alpha);"undefined"!==typeof m.fade&&PS.fade(d,g,m.fade);"undefined"!==typeof m.scale&&PS.scale(d,g,m.scale);"undefined"!==typeof m.radius&&PS.radius(d,g,m.radius);"undefined"!==typeof m.data&&PS.data(d,g,m.data);"function"===typeof typeof m.exec&&PS.exec(d,g,m.exec);"undefined"!==typeof m.visible&&PS.visible(d,g,m.visible);"undefined"!==typeof m.active&&PS.active(d,g,m.active);
"undefined"!==typeof m.border&&PS.border(d,g,m.border);"undefined"!==typeof m.borderColor&&PS.borderColor(d,g,m.borderColor);"undefined"!==typeof m.borderAlpha&&PS.borderAlpha(d,g,m.borderAlpha);"undefined"!==typeof m.borderFade&&PS.borderFade(d,g,m.borderFade);"undefined"!==typeof m.glyph&&PS.glyph(d,g,m.glyph);"undefined"!==typeof m.glyphColor&&PS.glyphColor(d,g,m.glyphColor);"undefined"!==typeof m.glyphAlpha&&PS.glyphAlpha(d,g,m.glyphAlpha);"undefined"!==typeof m.glyphScale&&PS.glyphScale(d,g,
m.glyphScale);"undefined"!==typeof m.glyphFade&&PS.glyphFade(d,g,m.glyphFade)}function forEach(d,g){for(var m=0;m<d.length;m++)g(d[m])}function forEachIn(d,g){for(var m in d)Object.prototype.hasOwnProperty.call(d,m)&&g(m,d[m])}function randomElement(d){if(0==d.length)throw Error("The array is empty.");return d[Math.floor(Math.random()*d.length)]}function Dictionary(d){this.values=d||{}}Dictionary.prototype.store=function(d,g){this.values[d]=g};Dictionary.prototype.lookup=function(d){return this.values[d]};
Dictionary.prototype.contains=function(d){return Object.prototype.hasOwnProperty.call(this.values,d)&&Object.prototype.propertyIsEnumerable.call(this.values,d)};Dictionary.prototype.each=function(d){forEachIn(this.values,d)};Dictionary.prototype.names=function(){var d=[];this.each(function(g,m){d.push(g)});return d};Object.prototype.create=function(){var d=clone(this);"function"==typeof d.construct&&d.construct.apply(d,arguments);return d};
Object.prototype.extend=function(d){var g=clone(this);forEachIn(d,function(d,p){g[d]=p});return g};function bind(d,g){return function(){return d.apply(g,arguments)}}function method(d,g){return function(){return d[g].apply(d,arguments)}}var LetterToNumber=function(d){return parseInt("0x"+d)},WholePart=function(d){return 0<d?Math.floor(d):Math.ceil(d)},FractionPart=function(d){return d-WholePart(d)};function Rect(d,g,m,p){this.l=d;this.t=g;this.r=m;this.b=p}Rect.prototype.overlap=function(d){return!(d.l>this.r||d.r<this.l||d.t>this.b||d.b<this.t)};Rect.prototype.intersection=function(d){var g=Math.max(this.l,d.l),m=Math.max(this.t,d.t),p=Math.min(this.r,d.r);d=Math.min(this.b,d.b);return new Rect(g,m,p,d)};Rect.prototype.isEqualTo=function(d){return this.l==d.l&&this.r==d.r&&this.t==d.t&&this.b==d.b};Rect.prototype.toString=function(){return"("+this.l+","+this.t+","+this.r+","+this.b+")"};
Rect.prototype.width=function(){return this.l-this.r+1};Rect.prototype.height=function(){return this.t-this.b+1};Rect.prototype.slide=function(d){return new Rect(this.l+d.x,this.t+d.y,this.r+d.x,this.b+d.y)};function Point(d,g){this.x=d;this.y=g}Point.prototype.add=function(d){return new Point(this.x+d.x,this.y+d.y)};Point.prototype.round=function(){return new Point(Math.round(this.x),Math.round(this.y))};Point.prototype.isEqualTo=function(d){return this.x==d.x&&this.y==d.y};Point.prototype.toString=function(){return"("+this.x+","+this.y+")"};Point.prototype.scale=function(d){return new Point(this.x*d.x,this.y*d.y)};
var PointLeft=new Point(-1,0),PointRight=new Point(1,0),PointUp=new Point(0,-1),PointDown=new Point(0,1);var CollisionTypes={none:0,trigger:1,solid:2,heavy:3,enviro:4,frozen:5},ResponseTypes={none:0,collision:1,move:2},CollisionMatrix=[[0,0,0,0,0,0],[0,1,1,1,1,1],[0,1,2,2,2,2],[0,1,1,1,2,2],[0,1,1,1,1,2],[0,1,1,1,1,1]];
function SpriteCollisionCheck(d,g){var m=!1;if(d.IsAlive()&&g.IsAlive()){var p=CollisionMatrix[d.collisionType][g.collisionType],B=CollisionMatrix[g.collisionType][g.collisionType];if(p&0===B)return!1;if(m=SpritesOverlap(d,g))Response(d,g,p),Response(g,d,B),d.Collide(g),g.Collide(d)}return m}
function SpritesOverlap(d,g,m){var p=!1,B,y,O,S,w,$,ra,sa;void 0!==m?(m=new Point(m.x,m.y),B=d.Rect().slide(m)):B=d.Rect();y=g.Rect();if(B.overlap(y))if(d.picture&&g.picture)for(m=B.intersection(y),O=-B.l,B=-B.t,S=-y.l,y=-y.t,w=m.l;w<=m.r;++w)for($=m.t;$<=m.b;++$)ra=d.picture[w+O+($+B)*d.w],sa=g.picture[w+S+($+y)*g.w],void 0!==ra&&void 0!==sa&&(p=!0);else p=!0;return p}
function Response(d,g,m){if(m===ResponseTypes.move){var p=WholePart(d.velocity.x),B=WholePart(d.velocity.y);if(0!==p||0!==B){m=new Point(-p,0);var y=new Point(0,-B),p=new Point(-p,-B),B=SpritesOverlap(d,g,y);(g=SpritesOverlap(d,g,m))&&!B?p=y:!g&&B&&(p=m);d.velocity=new Point(0,0);d.translation=p;d.PhysicsUpdate()}}};var Entity={construct:function(d){this.parent=d;this.Spawn(this.parent)},name:"EntityBaseType",type:"Entity",owner:"None",_dispose:!1,_active:!0,parent:void 0,Update:function(d){},Spawn:function(d){},Deconstruct:function(){},Removed:function(){},Collide:function(d){},Trigger:function(d){},PostRender:function(){},Destroy:function(){this._dispose=this._destroyed=!0;this._active=!1},Remove:function(){this._dispose=this._removed=!0;this._active=!1},IsAlive:function(){return this._active&&!this._dispose}};var Component=Entity.extend({construct:function(d,g){this.parent=d;this.owner=d.owner;forEachIn(g,bind(function(d,g){this[d]=g},this))},name:"ComponentBaseType",type:"Component",_Provide:function(d,g){this.parent&&(this.parent[d]=g)}});var GameObject=Entity.extend({name:"GameObjectBaseType",type:"GameObject",RegisterComponent:function(d,g){void 0===this._components&&(this._components=[]);this._components.push(d.create(this,g))},GetComponent:function(d){for(var g=0;g<this._components.length;++g)if(this._components[g].name===d.name)return this._components[g]},_components:void 0,Update:function(d){this._components&&forEach(this._components,function(g){g.Update(d)})},Spawn:function(d){if(this._components){var g=this;forEach(this._components,
function(d){d.Spawn(g)})}},Deconstruct:function(){this._components&&(forEach(this._components,function(d){d.Deconstruct()}),this._components=void 0)},Removed:function(){this._components&&(forEach(this._components,function(d){d.Removed()}),this._components=void 0)},Collide:function(d){this._components&&forEach(this._components,function(g){g.Collide(d)})},Trigger:function(d){this._components&&forEach(this._components,function(g){g.Trigger(d)})},PostRender:function(d){this._components&&forEach(this._components,
function(g){g.PostRender(d)})}});var Sprite=GameObject.extend({construct:function(d){GameObject.construct.call(this);this.h=this.w=1;this.palette=GAME.palette;this.point=new Point(d.x,d.y);this.translation=new Point(0,0);this.velocity=new Point(0,0);this._setupPicture();this._calcRect();this.visible=!0},name:"SpriteBaseType",type:"Sprite",palette:void 0,pattern:null,picture:null,zlayer:0,point:void 0,translation:void 0,velocity:void 0,acceleration:new Point(0,0),center:new Point(0,0),rect:void 0,collisionType:CollisionTypes.none,
Translate:function(d){this.translation.x+=d.x;this.translation.y+=d.y},Update:function(d){this.translation.x=FractionPart(this.translation.x);this.translation.y=FractionPart(this.translation.y);GameObject.Update.call(this,d)},PhysicsUpdate:function(d){this.velocity.x+=this.acceleration.x;this.velocity.y+=this.acceleration.y;this.translation.x+=this.velocity.x;this.translation.y+=this.velocity.y;this.point.x+=WholePart(this.translation.x);this.point.y+=WholePart(this.translation.y);this._calcRect()},
_calcRect:function(){void 0===this.rect&&(this.rect=new Rect(0,0,0,0));var d=this.point.round();this.rect.l=d.x-this.center.x;this.rect.t=d.y-this.center.y;this.rect.r=this.rect.l+this.w-1;this.rect.b=this.rect.t+this.h-1},Rect:function(){return this.rect},_setupPicture:function(){if(null!==this.pattern){this.picture=[];this.h=this.pattern.length;this.w=this.pattern[0].length;for(var d=0;d<this.h;d++)for(var g=0;g<this.w;g++){var m=this.pattern[d][g],p=void 0;" "!==m&&(p=LetterToNumber(m));this.picture.push(p)}}},
_render:function(){this.visible&&(this._draw(this.point),this.PostRender&&this.PostRender())},_draw:function(d){if(null!==this.picture){d=d.round();for(var g=0;g<this.h;g++)for(var m=0;m<this.w;m++){var p=d.x+m-this.center.x,B=d.y+g-this.center.y;if(0<=p&&p<GAME.w&&0<=B&&B<GAME.h){var y=this.picture[m+g*this.w];void 0!==y&&PS.style(p,B,this.palette[y])}}}}});var sPalette=[],skyColor=10083839,sBackground={color:skyColor,glyph:0,alpha:255,radius:0,borderColor:skyColor,border:0},sBackgroundFast={color:skyColor,glyph:0},sTransparent={alpha:0};
(function(){var d=function(d){this.color=d};sPalette.push(new d(PS.makeRGB(20,12,28)));sPalette.push(new d(PS.makeRGB(68,36,52)));sPalette.push(new d(PS.makeRGB(48,52,109)));sPalette.push(new d(PS.makeRGB(78,74,78)));sPalette.push(new d(PS.makeRGB(133,76,48)));sPalette.push(new d(PS.makeRGB(52,101,36)));sPalette.push(new d(PS.makeRGB(208,70,72)));sPalette.push(new d(PS.makeRGB(117,113,97)));sPalette.push(new d(PS.makeRGB(89,125,206)));sPalette.push(new d(PS.makeRGB(210,125,44)));sPalette.push(new d(PS.makeRGB(133,
149,161)));sPalette.push(new d(PS.makeRGB(109,170,44)));sPalette.push(new d(PS.makeRGB(210,170,153)));sPalette.push(new d(PS.makeRGB(109,194,202)));sPalette.push(new d(PS.makeRGB(218,212,94)));sPalette.push(new d(PS.makeRGB(222,238,214)))})();var GAME={w:32,h:32,time:0,timeRate:1,entityList:[],keysHeld:[],keysPressed:[],keysReleased:[],palette:sPalette,bounds:void 0,touches:[],title:"",initialize:function(){PS.gridSize(GAME.w,GAME.h);GAME.bounds=new Rect(0,0,GAME.w-1,GAME.h-1);PS.gridColor(sBackgroundFast.color);PS.statusColor(PS.COLOR_BLACK);PS.style(PS.ALL,PS.ALL,sBackground);GAME.sounds.preload();GAME.timer=PS.timerStart(GAME.timeRate,function(){GAME.GameLoop()})},Rect:function(){return GAME.bounds}};GAME.entityTypes=new Dictionary;
GAME.entityTypes.register=function(d){this.store(d.name,d)};GAME.Spawn=function(d,g,m){d=d.create(g,m);this.entityList.push(d);return d};GAME.GetEntitiesOfType=function(d){for(var g=[],m=0;m<this.entityList.length;++m)this.entityList[m].type===d&&g.push(this.entityList[m]);return g};GAME.GetEntitiesOfName=function(d){for(var g=[],m=0;m<this.entityList.length;++m)this.entityList[m].name===d&&g.push(this.entityList[m]);return g};
GAME.KeyHandler=function(d,g){g!=this.keysHeld[d]&&((this.keysHeld[d]=g)?this.keysPressed[d]=!0:this.keysReleased[d]=!0)};GAME.TouchHandler=function(d,g){this.touches.push(new Point(d,g))};GAME.InputUpdate=function(){this.keysPressed=[];this.touches=[]};GAME.KeyDown=function(d){return!0==this.keysHeld[d]};GAME.KeyPressed=function(d){return!0==this.keysPressed[d]};GAME.Touched=function(){return 0<this.touches.length};GAME.Touches=function(){return this.touches};
GAME.GameLoop=function(){this.Update();this.Render()};GAME.Update=function(){this.time++;this.SpriteUpdate(this.time);this.PhysicsUpdate(this.time);this.CollisionUpdate();this.CleanupEntities();this.InputUpdate()};GAME.SpriteUpdate=function(d){forEach(this.entityList,function(g){g.Update&&g.IsAlive()&&g.Update(d)})};GAME.PhysicsUpdate=function(d){forEach(this.entityList,function(g){g.PhysicsUpdate&&g.IsAlive()&&g.PhysicsUpdate(d)})};
GAME.CollisionUpdate=function(){for(var d=this.entityList.length,g=0;g<d-1;g++)for(var m=g+1;m<d;m++)SpriteCollisionCheck(this.entityList[g],this.entityList[m])};GAME.CleanupEntities=function(){for(var d=0;d<this.entityList.length;++d)this.entityList[d]._dispose&&(this.entityList[d]._destroyed&&this.entityList[d].Deconstruct(),this.entityList[d]._removed&&this.entityList[d].Removed(),this.entityList.splice(d,1),d--)};
GAME.Render=function(){this.ClearScreen();var d=this.entityList.slice(0);forEach(d,function(d){"function"===typeof d._render&&d._render()});forEach(d,function(d){"function"===typeof d._render&&10<=d.zlayer&&d._render()})};GAME.ClearScreen=function(){PS.style(PS.ALL,PS.ALL,sBackgroundFast)};GAME.sounds=new Dictionary;GAME.sounds.preload=function(){this.each(function(d,g){PS.audioLoad(g)})};GAME.sounds.play=function(d){PS.audioPlay(this.lookup(d))};GAME.sounds.store("Explode","fx_shoot3");GAME.sounds.store("Flap","fx_rip");GAME.sounds.store("Impact","fx_shoot7");GAME.sounds.store("Score","fx_coin7");GAME.sounds.store("Spawning","fx_powerup1");var TapAnywhereToDestroy=Component.extend({name:"TapAnywhereToDestroy",activateKey:32,age:0,Update:function(d){0<this.age&&(GAME.KeyPressed(this.activateKey)||GAME.Touched())&&this.parent.Destroy();this.age++}}),TimedDestructor=Component.extend({name:"TimedDestructor",fuse:10,Update:function(d){0>=this.fuse--&&this.parent.Destroy()}}),Exploder=Component.extend({name:"Exploder",Deconstruct:function(){GAME.sounds.play("Explode");GAME.Spawn(Explosion,this.parent.point)}}),ContainsObject=Component.extend({name:"ContainsObject",
chance:1,obj:void 0,Deconstruct:function(){this.obj&&1==randBetween(1,this.chance)&&GAME.Spawn(this.obj,this.parent.point)}}),SoundOnSpawn=Component.extend({name:"SoundOnSpawn",sound:"Spawning",Spawn:function(d){GAME.sounds.play(this.sound)}}),Blinker=Component.extend({name:"Blinker",rate:3,on:!1,color:16777215,Update:function(d){0==d%this.rate&&(this.on=!this.on)},PostRender:function(){if(this.on)for(var d=this.parent.point.round(),g=this.parent.center,m=this.parent.w,p=this.parent.h,B=this.parent.picture,
y=0;y<p;y++)for(var O=0;O<m;O++){var S=d.x+O-g.x,w=d.y+y-g.y;0<=S&&S<GAME.w&&0<=w&&w<GAME.h&&void 0!==B[O+y*m]&&PS.style(S,w,{color:this.color})}}}),RemoveOffLeftEdge=Component.extend({name:"RemoveOffBottomEdge",Update:function(d){0>this.parent.Rect().r&&this.parent.Remove()}});var BirdController=Sprite.extend({construct:function(d){Sprite.construct.call(this,d)},name:"BirdController",type:"Controller",activateKey:32,state:"",bird:null,birdStationary:null,scoreDisplay:null,spawnLocation:new Point(8,15),zlayer:2,Spawn:function(){this.worldSpawner=GAME.Spawn(WorldSpawner,new Point(-1,-1));this.scoreDisplay=GAME.Spawn(ScoreDisplay,new Point(15,1));this.hiscoreDisplay=GAME.Spawn(ScoreDisplay,new Point(15,24));this._Start()},_Start:function(){this.state="Start";this.birdStationary=
GAME.Spawn(BirdStationary,this.spawnLocation);this.worldSpawner.Clear();this.worldSpawner.Floor();GAME.Spawn(Tap,new Point(13,15));this.scoreDisplay.Reset();this.scoreDisplay.visible=!1;this.hiscoreDisplay.visible=!1;for(var d=GAME.GetEntitiesOfName("BirdDown"),g=0;g<d.length;++g)d[g].Destroy()},_Play:function(){this.state="Play";this.birdStationary.Destroy();this.birdStationary=null;this.bird=GAME.Spawn(Bird,this.spawnLocation);this.scoreDisplay.visible=!0;this.worldSpawner.Start()},_Dead:function(){this.state=
"Dead";this.bird=null;this.worldSpawner.Stop();GAME.Spawn(Best,new Point(15,18));this.hiscoreDisplay.SetPoints(this.scoreDisplay.best);this.hiscoreDisplay.visible=!0},Update:function(d){d=GAME.KeyPressed(this.activateKey)||GAME.Touched();switch(this.state){case "Start":d&&this._Play();break;case "Play":this.bird.IsAlive()||this._Dead();break;case "Dead":d&&this._Start()}}}),BirdStationary=Sprite.extend({construct:function(d){this.RegisterComponent(SoundOnSpawn);Sprite.construct.call(this,d)},name:"BirdStationary",
type:"Pawn",center:new Point(1,1),pattern:["16 ","606","E6 "],Spawn:function(){PS.statusText(GAME.title)}}),Bird=Sprite.extend({construct:function(d){this.RegisterComponent(Flapper,{vel:new Point(0,-1)});this.RegisterComponent(GetsPoints);this.RegisterComponent(HatesPipes);this.RegisterComponent(Exploder);this.RegisterComponent(ContainsObject,{obj:BirdDown});Sprite.construct.call(this,d)},name:"Bird",type:"Pawn",collisionType:CollisionTypes.solid,center:new Point(1,1),acceleration:new Point(0,0.07),
pattern:["16 ","606","E6 "],Collide:function(d){Sprite.Collide.call(this,d);"Obstacle"==d.type&&this.Destroy()}}),BirdDown=Sprite.extend({construct:function(d){Sprite.construct.call(this,d);this.velocity=new Point(0.5,0)},name:"BirdDown",type:"Pawn",collisionType:CollisionTypes.solid,dead:!1,center:new Point(1,1),acceleration:new Point(0,0.09),pattern:["E61","606"," 6 "],Collide:function(d){Sprite.Collide.call(this,d);"Ground"!=d.name||this.dead||(this.acceleration=new Point(0,0),this.velocity=new Point(0,
0),GAME.sounds.play("Impact"),this.dead=!0)}}),Flapper=Component.extend({name:"Flapper",vel:new Point(0,-1),activateKey:32,sound:"Flap",Update:function(d){if(GAME.KeyPressed(this.activateKey)||GAME.Touched())GAME.sounds.play(this.sound),this.parent.velocity=new Point(this.vel.x,this.vel.y);d=this.parent.Rect();var g=GAME.Rect(),m=this.parent.velocity;d.t+m.y<=g.t&&this.parent.Translate(new Point(0,g.t-(d.t+m.y)));d.b+m.y>=g.b&&(this.parent.Translate(new Point(0,g.b-(d.b+m.y))),this.parent.velocity=
new Point(0,0))}}),HatesPipes=Component.extend({name:"HatesPipes",hateType:"Pipe",sound:"Impact",Collide:function(d){d.type===this.hateType&&(GAME.sounds.play(this.sound),this.parent.Destroy())}}),GetsPoints=Component.extend({name:"GetsPoints",pointType:"Points",sound:"Score",score:0,scoreDisplay:null,DisplayScore:function(){this.scoreDisplay.SetPoints(this.score)},Spawn:function(){this.scoreDisplay=GAME.GetEntitiesOfName("ScoreDisplay")[0];this.DisplayScore()},Collide:function(d){d.type===this.pointType&&
(GAME.sounds.play(this.sound),d.Destroy(),this.score++,this.DisplayScore())}});var PipeCap=Sprite.extend({construct:function(d){this.RegisterComponent(RemoveOffLeftEdge);Sprite.construct.call(this,d);this.velocity=new Point(-0.5,0)},name:"PipeCap",type:"Obstacle",collisionType:CollisionTypes.trigger,zlayer:2,center:new Point(2,0),pattern:["BBBBB","B5555"]}),PipeLength=Sprite.extend({construct:function(d){this.RegisterComponent(RemoveOffLeftEdge);Sprite.construct.call(this,d);this.velocity=new Point(-0.5,0)},name:"PipeLength",type:"Obstacle",collisionType:CollisionTypes.trigger,
zlayer:1,center:new Point(1,0),pattern:"B55 B55 B55 B55 B55 B55 B55 B55 B55 B55 B55 B55 B55 B55 B55 B55 B55 B55 B55 B55".split(" ")});var WorldSpawner=Sprite.extend({construct:function(d){Sprite.construct.call(this,d)},name:"WorldSpawner",type:"Spawner",collisionType:CollisionTypes.none,pattern:["F"],rate:40,ySeparation:14,yBuffer:10,yOffset:-2,state:"Stop",Update:function(d){switch(this.state){case "Floor":0===d%10&&GAME.Spawn(Ground,new Point(GAME.w,GAME.h-2));break;case "Go":var g=this.ySeparation;if(0===d%this.rate){var m=randBetween(0+this.yBuffer,GAME.h-this.yBuffer)+this.yOffset,p=GAME.w+2;GAME.Spawn(PipeCap,new Point(p,
m-g/2));GAME.Spawn(ScoreTrigger,new Point(p,m-g/2+2));GAME.Spawn(PipeCap,new Point(p,m+g/2));GAME.Spawn(PipeLength,new Point(p,m-g/2-20));GAME.Spawn(PipeLength,new Point(p,m+g/2+2))}0===d%10&&GAME.Spawn(Ground,new Point(GAME.w,GAME.h-2))}},Start:function(){this.state="Go"},Stop:function(){this.state="Stop";for(var d=GAME.GetEntitiesOfType("Obstacle"),g=0;g<d.length;++g)d[g].velocity.x=0},Clear:function(){for(var d=GAME.GetEntitiesOfType("Obstacle"),g=0;g<d.length;++g)d[g].Destroy();d=GAME.GetEntitiesOfType("Points");
for(g=0;g<d.length;++g)d[g].Destroy()},Floor:function(){this.state="Floor";for(var d=0;d<GAME.w+5;d+=5)GAME.Spawn(Ground,new Point(d,GAME.h-2))}});var Tap=Sprite.extend({construct:function(d){this.RegisterComponent(Blinker,{rate:20,color:16777215});this.RegisterComponent(TapAnywhereToDestroy);Sprite.construct.call(this,d)},name:"Tap",type:"Text",zlayer:10,center:new Point(2,2),pattern:["ddd ddd ddd"," 8  8 8 8 8"," 2  222 222"," 1  1 1 1  "," 0  0 0 0  "]});var Best=Sprite.extend({construct:function(d){this.RegisterComponent(TapAnywhereToDestroy);Sprite.construct.call(this,d)},name:"Best",type:"Text",zlayer:10,center:new Point(6,0),pattern:["ddd ddd ddd ddd","8 8 8   8    8 ","22  222 222  2 ","1 1 1     1  1 ","000 000 000  0 "]});var Ground=Sprite.extend({construct:function(d){this.RegisterComponent(RemoveOffLeftEdge);Sprite.construct.call(this,d);this.velocity=new Point(-0.5,0)},name:"Ground",type:"Obstacle",collisionType:CollisionTypes.solid,zlayer:5,center:new Point(0,0),pattern:["44411","11100"]});var Explosion=Sprite.extend({construct:function(d){this.RegisterComponent(TimedDestructor,{fuse:9});this.RegisterComponent(Blinker,{rate:2});Sprite.construct.call(this,d)},name:"Explosion",type:"Effect",collisionType:CollisionTypes.none,zlayer:10,center:new Point(2,2),pattern:["E 9 E"," 9E9 ","9EEE9"," 9E9 ","E 9 E"]});var ScoreTrigger=Sprite.extend({construct:function(d){this.RegisterComponent(RemoveOffLeftEdge);Sprite.construct.call(this,d);this.velocity=new Point(-0.5,0);this.w=1;this.h=12;this.visible=!1},name:"ScoreTrigger",type:"Points",collisionType:CollisionTypes.trigger,center:new Point(0,0)});var ScoreDisplay=Sprite.extend({construct:function(d){Sprite.construct.call(this,d);this.numerals=[];for(var g=0;g<BIG_NUM.length;++g)this.numerals.push(BIG_NUM[g].create(d))},name:"ScoreDisplay",type:"UI",zlayer:10,value:0,best:0,numerals:[],centered:!0,Reset:function(){this.value=0},AddPoints:function(d){this.SetPoints(d+this.value)},SetPoints:function(d){this.value=d;this.best=Math.max(this.best,this.value)},PostRender:function(){var d=this.value.toString(),g=this.point.x,m=this.point.y;this.centered&&
(g-=2*d.length-2);for(var p=0;p<d.length;++p){var B=parseInt(d[p]);this.numerals[B]._draw(new Point(g+4*p,m))}}}),Numeral=Sprite.extend({name:"Numeral",type:"Text",center:new Point(0,0),pattern:["0"],layer:10}),BIG_NUM=[];BIG_NUM[0]=Numeral.extend({pattern:["000","0 0","0 0","0 0","000"]});BIG_NUM[1]=Numeral.extend({pattern:[" 0 ","00 "," 0 "," 0 ","000"]});BIG_NUM[2]=Numeral.extend({pattern:["000","  0","000","0  ","000"]});BIG_NUM[3]=Numeral.extend({pattern:["000","  0","000","  0","000"]});
BIG_NUM[4]=Numeral.extend({pattern:["0 0","0 0","000","  0","  0"]});BIG_NUM[5]=Numeral.extend({pattern:["000","0  ","000","  0","000"]});BIG_NUM[6]=Numeral.extend({pattern:["000","0  ","000","0 0","000"]});BIG_NUM[7]=Numeral.extend({pattern:["000","  0","  0","  0","  0"]});BIG_NUM[8]=Numeral.extend({pattern:["000","0 0","000","0 0","000"]});BIG_NUM[9]=Numeral.extend({pattern:["000","0 0","000","  0","  0"]});var TestComponent=Component.extend({name:"TestComponent",Update:function(d){},Spawn:function(d){},Deconstruct:function(){},Collide:function(d){},Trigger:function(d){},PostRender:function(){for(var d=this.parent.point.round(),g=this.parent.center,m=this.parent.w,p=this.parent.h,B=this.parent.pattern,y=0;y<p;y++)for(var O=0;O<m;O++){var S=d.x+O-g.x,w=d.y+y-g.y;0<=S&&S<GAME.w&&0<=w&&w<GAME.h&&PS.glyph(S,w,B[y][O])}}}),TestSprite=Sprite.extend({construct:function(d){this.RegisterComponent(TestComponent);
Sprite.construct.call(this,d)},name:"TestSprite",collisionType:CollisionTypes.solid,pattern:["0123","4567","89AB","CDEF"]});PS.debug=function(){console.log(arguments)};PS.init=function(d,g){GAME.initialize();GAME.Spawn(BirdController,new Point(-1,-1));var m=document.getElementById("footer"),p=document.createElement("a");p.setAttribute("href","./FlappyBead.zip");p.innerText="Download Source";m.appendChild(document.createElement("br"));m.appendChild(p)};PS.keyDown=function(d,g,m,p){GAME.KeyHandler(d,!0)};PS.keyUp=function(d,g,m,p){GAME.KeyHandler(d,!1)};PS.touch=function(d,g,m,p){GAME.TouchHandler(d,g)};
PS.release=function(d,g,m,p){};PS.enter=function(d,g,m,p){};PS.exit=function(d,g,m,p){};PS.exitGrid=function(d){};PS.input=function(d,g){};
//# sourceMappingURL=perlenspiel.min.js.map 
